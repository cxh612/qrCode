!function(t,e,T){T.un,T.uns;var n=T.static,c=T.class,r=T.getset,a=T.__newvec,l=laya.maths.Arith,u=laya.maths.Bezier,i=laya.resource.Bitmap,f=laya.utils.Browser,h=laya.utils.Byte,d=laya.utils.Color,A=(laya.filters.ColorFilter,T.Config),s=laya.resource.Context,E=(laya.events.Event,laya.filters.Filter),o=laya.display.Graphics,_=laya.resource.HTMLCanvas,m=(laya.utils.HTMLChar,laya.resource.HTMLImage),p=laya.resource.HTMLSubImage,S=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),w=laya.maths.Point,R=laya.maths.Rectangle,g=laya.renders.Render,v=(laya.renders.RenderContext,laya.renders.RenderSprite),x=laya.resource.Resource,b=laya.resource.ResourceManager,y=laya.utils.RunDriver,I=laya.display.Sprite,M=laya.display.Stage,C=laya.utils.Stat,L=laya.utils.StringKey,P=(laya.display.css.Style,laya.system.System),D=laya.display.Text,F=laya.resource.Texture,B=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),N=laya.utils.VectorGraphManager;laya.utils.WordText;T.interface("laya.webgl.shapes.IShape"),T.interface("laya.webgl.submit.ISubmit"),T.interface("laya.webgl.text.ICharSegment"),T.interface("laya.webgl.canvas.save.ISaveData"),T.interface("laya.webgl.resource.IMergeAtlasBitmap"),T.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var O=function(){function t(){}c(t,"laya.filters.webgl.FilterActionGL");var e=t.prototype;return T.imps(e,{"laya.filters.IFilterActionGL":!0}),e.setValue=function(t){},e.setValueMix=function(t){},e.apply3d=function(t,e,i,r,s){return null},e.apply=function(t){return null},r(0,e,"typeMix",function(){return 0}),t}(),V=function(){function t(){}return c(t,"laya.webgl.shader.ShaderValue"),t}(),U=function(){var r,s;function t(t,e,i){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new s,void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._cells=null,this._rowInfo=null,this._init(t,e),this._atlasID=i}c(t,"laya.webgl.atlas.AtlasGrid");var e=t.prototype;return e.getAltasID=function(){return this._atlasID},e.setAltasID=function(t){0<=t&&(this._atlasID=t)},e.addTex=function(t,e,i){var r=this._get(e,i);return 0==r.ret||(this._fill(r.x,r.y,e,i,t),this._texCount++),r},e._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},e._init=function(t,e){if(this._width=t,this._height=e,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=a(this._height);for(var i=0;i<this._height;i++)this._rowInfo[i]=new r;return this._clear(),!0},e._get=function(t,e){var i=new H;if(t>=this._failSize.width&&e>=this._failSize.height)return i;for(var r=-1,s=-1,a=this._width,n=this._height,h=this._cells,l=0;l<n;l++)if(!(this._rowInfo[l].spaceCount<t))for(var o=0;o<a;){var u=3*(l*a+o);if(0!=h[u]||h[u+1]<t||h[u+2]<e)o+=h[u+1];else{r=o,s=l;for(var _=0;_<t;_++)if(h[3*_+u+2]<e){r=-1;break}if(!(r<0))return i.ret=!0,i.x=r,i.y=s,i;o+=h[u+1]}}return i},e._fill=function(t,e,i,r,s){var a=this._width,n=this._height;this._check(t+i<=a&&e+r<=n);for(var h=e;h<r+e;++h){this._check(this._rowInfo[h].spaceCount>=i),this._rowInfo[h].spaceCount-=i;for(var l=0;l<i;l++){var o=3*(t+h*a+l);this._check(0==this._cells[o]),this._cells[o]=s,this._cells[o+1]=i,this._cells[o+2]=r}}if(0<t)for(h=0;h<r;++h){var u=0;for(l=t-1;0<=l&&0==this._cells[3*((e+h)*a+l)];--l,++u);for(l=u;0<l;--l)this._cells[3*((e+h)*a+t-l)+1]=l,this._check(0<l)}if(0<e)for(l=t;l<t+i;++l){for(u=0,h=e-1;0<=h&&0==this._cells[3*(l+h*a)];--h,u++);for(h=u;0<h;--h)this._cells[3*(l+(e-h)*a)+2]=h,this._check(0<h)}},e._check=function(t){0==t&&console.log("xtexMerger 错误啦")},e._clear=function(){for(var t=this._texCount=0;t<this._height;t++)this._rowInfo[t].spaceCount=this._width;for(var e=0;e<this._height;e++)for(var i=0;i<this._width;i++){var r=3*(e*this._width+i);this._cells[r]=0,this._cells[r+1]=this._width-i,this._cells[r+2]=this._width-e}this._failSize.width=this._width+1,this._failSize.height=this._height+1},t.__init$=function(){r=function(){function t(){this.spaceCount=0}return c(t,""),t}(),s=function(){function t(){this.width=0,this.height=0}return c(t,""),t}()},t}(),k=function(){function g(t,e,i,r){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=t,this._height=e,this._gridSize=i,this._maxAtlaserCount=r,this._gridNumX=t/i,this._gridNumY=e/i,this._curAtlasIndex=0,this._atlaserArray=[]}c(g,"laya.webgl.atlas.AtlasResourceManager");var t=g.prototype;return t.setAtlasParam=function(t,e,i,r){if(1==this._setAtlasParam)return g._sid_=0,this._width=t,this._height=e,this._gridSize=i,this._maxAtlaserCount=r,this._gridNumX=t/i,this._gridNumY=e/i,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},t.pushData=function(t){var e,i=t.bitmap,r=-1,s=null,a=0,n=0;for(a=0,e=this._atlaserArray.length;a<e&&(n=(this._curAtlasIndex+a)%e,-1==(r=(s=this._atlaserArray[n]).findBitmapIsExist(i)));a++);if(-1!=r){var h=s.InAtlasWebGLImagesOffsetValue[r];return d=h[0],m=h[1],s.addToAtlas(t,d,m),!0}this._setAtlasParam=!1;for(var l=Math.ceil((t.bitmap.width+2)/this._gridSize),o=Math.ceil((t.bitmap.height+2)/this._gridSize),u=!1,_=0;_<2;_++){var c=this._maxAtlaserCount;for(a=0;a<c;a++){n=(this._curAtlasIndex+a)%c,this._atlaserArray.length-1>=n||this._atlaserArray.push(new Rt(this._gridNumX,this._gridNumY,this._width,this._height,g._sid_++));var f=this._atlaserArray[n],d=0,m=0,p=f.addTex(1,l,o);if(p.ret){d=p.x*this._gridSize+1,m=p.y*this._gridSize+1,i.lock=!0,f.addToAtlasTexture(i,d,m),f.addToAtlas(t,d,m),u=!0,this._curAtlasIndex=n;break}}if(u)break;this._atlaserArray.push(new Rt(this._gridNumX,this._gridNumY,this._width,this._height,g._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return u||console.log(">>>AtlasManager pushData error"),u},t.addToAtlas=function(t){laya.webgl.atlas.AtlasResourceManager.instance.pushData(t)},t.garbageCollection=function(){if(!0===this._needGC){for(var t=this._atlaserArray.length-this._maxAtlaserCount,e=0;e<t;e++)this._atlaserArray[e].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+t),this._atlaserArray.splice(0,t),this._needGC=!1}return!0},t.freeAll=function(){for(var t=0,e=this._atlaserArray.length;t<e;t++)this._atlaserArray[t].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},t.getAtlaserCount=function(){return this._atlaserArray.length},t.getAtlaserByIndex=function(t){return this._atlaserArray[t]},r(1,g,"instance",function(){return g._Instance||(g._Instance=new g(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),g._Instance}),r(1,g,"enabled",function(){return A.atlasEnable}),r(1,g,"atlasLimitWidth",function(){return g._atlasLimitWidth},function(t){g._atlasLimitWidth=t}),r(1,g,"atlasLimitHeight",function(){return g._atlasLimitHeight},function(t){g._atlasLimitHeight=t}),g._enable=function(){A.atlasEnable=!0},g._disable=function(){A.atlasEnable=!1},g.__init__=function(){g.atlasTextureWidth=2048,g.atlasTextureHeight=2048,g.maxTextureCount=6,g.atlasLimitWidth=512,g.atlasLimitHeight=512},g._atlasLimitWidth=0,g._atlasLimitHeight=0,g.gridSize=16,g.atlasTextureWidth=0,g.atlasTextureHeight=0,g.maxTextureCount=0,g._atlasRestore=0,g.BOARDER_TYPE_NO=0,g.BOARDER_TYPE_RIGHT=1,g.BOARDER_TYPE_LEFT=2,g.BOARDER_TYPE_BOTTOM=4,g.BOARDER_TYPE_TOP=8,g.BOARDER_TYPE_ALL=15,g._sid_=0,g._Instance=null,g}(),H=function(){function t(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return c(t,"laya.webgl.atlas.MergeFillInfo"),t}(),G=function(){function e(){}return c(e,"laya.webgl.canvas.BlendMode"),e._init_=function(t){e.fns=[e.BlendNormal,e.BlendAdd,e.BlendMultiply,e.BlendScreen,e.BlendOverlay,e.BlendLight,e.BlendMask,e.BlendDestinationOut],e.targetFns=[e.BlendNormalTarget,e.BlendAddTarget,e.BlendMultiplyTarget,e.BlendScreenTarget,e.BlendOverlayTarget,e.BlendLightTarget,e.BlendMask,e.BlendDestinationOut]},e.BlendNormal=function(t){t.blendFunc(1,771)},e.BlendAdd=function(t){t.blendFunc(1,772)},e.BlendMultiply=function(t){t.blendFunc(774,771)},e.BlendScreen=function(t){t.blendFunc(1,1)},e.BlendOverlay=function(t){t.blendFunc(1,769)},e.BlendLight=function(t){t.blendFunc(1,1)},e.BlendNormalTarget=function(t){t.blendFunc(1,771)},e.BlendAddTarget=function(t){t.blendFunc(1,772)},e.BlendMultiplyTarget=function(t){t.blendFunc(774,771)},e.BlendScreenTarget=function(t){t.blendFunc(1,1)},e.BlendOverlayTarget=function(t){t.blendFunc(1,769)},e.BlendLightTarget=function(t){t.blendFunc(1,1)},e.BlendMask=function(t){t.blendFunc(0,770)},e.BlendDestinationOut=function(t){t.blendFunc(0,0)},e.activeBlendFunction=null,e.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],e.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},e.NORMAL="normal",e.ADD="add",e.MULTIPLY="multiply",e.SCREEN="screen",e.LIGHT="light",e.OVERLAY="overlay",e.DESTINATIONOUT="destination-out",e.fns=[],e.targetFns=[],e}(),z=function(){function i(t){this._color=d.create("black"),this.setValue(t)}c(i,"laya.webgl.canvas.DrawStyle");var t=i.prototype;return t.setValue=function(t){if(t){if("string"==typeof t)return void(this._color=d.create(t));if(t instanceof laya.utils.Color)return void(this._color=t)}},t.reset=function(){this._color=d.create("black")},t.equal=function(t){return"string"==typeof t?this._color.strColor===t:t instanceof laya.utils.Color&&this._color.numColor===t.numColor},t.toColorStr=function(){return this._color.strColor},i.create=function(t){var e;if(t&&("string"==typeof t?e=d.create(t):t instanceof laya.utils.Color&&(e=t),e))return e._drawStyle||(e._drawStyle=new i(t));return laya.webgl.canvas.DrawStyle.DEFAULT},n(i,["DEFAULT",function(){return this.DEFAULT=new i("#000000")}]),i}(),W=function(){function t(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];bt.mainContext;this.ib=$t.create(35048),this.vb=Jt.create(5)}c(t,"laya.webgl.canvas.Path");var e=t.prototype;return e.addPoint=function(t,e){this.tempArray.push(t,e)},e.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},e.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},e.polygon=function(t,e,i,r,s,a){var n;return this.geomatrys.push(this._curGeomatry=n=new Lt(t,e,i,r,s,a)),r||(n.fill=!1),null==a&&(n.borderWidth=0),n},e.setGeomtry=function(t){this.geomatrys.push(this._curGeomatry=t)},e.drawLine=function(t,e,i,r,s){var a;return this.closePath?this.geomatrys.push(this._curGeomatry=a=new Ct(t,e,i,r,s)):this.geomatrys.push(this._curGeomatry=a=new Mt(t,e,i,r,s)),a.fill=!1,a},e.update=function(){var t=this.ib._byteLength,e=this.geomatrys.length;this.offset=t;for(var i=this.geoStart;i<e;i++)this.geomatrys[i].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=e,this.count=(this.ib._byteLength-t)/mt.BYTES_PIDX},e.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},e.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},t}(),Y=function(){function h(){}c(h,"laya.webgl.canvas.save.SaveBase");var t=h.prototype;return T.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._dataObj[this._valueName]=this._value,(h._cache[h._cache._length++]=this)._newSubmit&&(t._curSubmit=at.RENDERBASE,t._renderKey=0)},h._createArray=function(){var t=[];return t._length=0,t},h._init=function(){var t=h._namemap={};return t[1]="ALPHA",t[2]="fillStyle",t[8]="font",t[256]="lineWidth",t[512]="strokeStyle",t[8192]="_mergeID",t[1024]=t[2048]=t[4096]=[],t[16384]="textBaseline",t[32768]="textAlign",t[65536]="_nBlendType",t[1048576]="shader",t[2097152]="filters",t},h.save=function(t,e,i,r){if((t._saveMark._saveuse&e)!==e){t._saveMark._saveuse|=e;var s=h._cache,a=0<s._length?s[--s._length]:new h;a._value=i[a._valueName=h._namemap[e]],a._dataObj=i,a._newSubmit=r;var n=t._save;n[n._length++]=a}},h._cache=laya.webgl.canvas.save.SaveBase._createArray(),h._namemap=h._init(),h}(),X=function(){function a(){this._clipRect=new R}c(a,"laya.webgl.canvas.save.SaveClipRect");var t=a.prototype;return T.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){t._clipRect=this._clipSaveRect,(a._cache[a._cache._length++]=this)._submitScissor.submitLength=t._submits._length-this._submitScissor.submitIndex,t._curSubmit=at.RENDERBASE,t._renderKey=0},a.save=function(t,e){if(131072!=(131072&t._saveMark._saveuse)){t._saveMark._saveuse|=131072;var i=a._cache,r=0<i._length?i[--i._length]:new a;r._clipSaveRect=t._clipRect,t._clipRect=r._clipRect.copyFrom(t._clipRect),r._submitScissor=e;var s=t._save;s[s._length++]=r}},n(a,["_cache",function(){return this._cache=Y._createArray()}]),a}(),K=function(){function f(){this._contextX=0,this._contextY=0,this._clipRect=new R,this._rect=new R,this._matrix=new S}c(f,"laya.webgl.canvas.save.SaveClipRectStencil");var t=f.prototype;return T.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){ut.restore(t,this._rect,this._saveMatrix,this._contextX,this._contextY),t._clipRect=this._clipSaveRect,t._curMat=this._saveMatrix,t._x=this._contextX,t._y=this._contextY,f._cache[f._cache._length++]=this,t._curSubmit=at.RENDERBASE},f.save=function(t,e,i,r,s,a,n,h,l,o){if(262144!=(262144&t._saveMark._saveuse)){t._saveMark._saveuse|=262144;var u=f._cache,_=0<u._length?u[--u._length]:new f;_._clipSaveRect=t._clipRect,_._clipRect.setTo(n,h,l,o),t._clipRect=_._clipRect,_._rect.x=i,_._rect.y=r,_._rect.width=s,_._rect.height=a,_._contextX=t._x,_._contextY=t._y,_._saveMatrix=t._curMat,t._curMat.copyTo(_._matrix),t._curMat=_._matrix,_._submitStencil=e;var c=t._save;c[c._length++]=_}},n(f,["_cache",function(){return this._cache=Y._createArray()}]),f}(),Q=function(){function r(){this._saveuse=0}c(r,"laya.webgl.canvas.save.SaveMark");var t=r.prototype;return T.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!0},t.restore=function(t){t._saveMark=this._preSaveMark,r._no[r._no._length++]=this},r.Create=function(t){var e=r._no,i=0<e._length?e[--e._length]:new r;return i._saveuse=0,i._preSaveMark=t._saveMark,t._saveMark=i},n(r,["_no",function(){return this._no=Y._createArray()}]),r}(),Z=function(){function a(){this._matrix=new S}c(a,"laya.webgl.canvas.save.SaveTransform");var t=a.prototype;return T.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){t._curMat=this._savematrix,a._no[a._no._length++]=this},a.save=function(t){var e=t._saveMark;if(2048!=(2048&e._saveuse)){e._saveuse|=2048;var i=a._no,r=0<i._length?i[--i._length]:new a;r._savematrix=t._curMat,t._curMat=t._curMat.copyTo(r._matrix);var s=t._save;s[s._length++]=r}},n(a,["_no",function(){return this._no=Y._createArray()}]),a}(),q=function(){function s(){}c(s,"laya.webgl.canvas.save.SaveTranslate");var t=s.prototype;return T.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){t._curMat;t._x=this._x,t._y=this._y,s._no[s._no._length++]=this},s.save=function(t){var e=s._no,i=0<e._length?e[--e._length]:new s;i._x=t._x,i._y=t._y;var r=t._save;r[r._length++]=i},n(s,["_no",function(){return this._no=Y._createArray()}]),s}(),j=function(){function t(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new R}c(t,"laya.webgl.resource.RenderTargetMAX");var e=t.prototype;return e.setSP=function(t){this._sp=t},e.size=function(t,e){var i=this;this._width!==t||this._height!==e?(this.repaint=!0,this._width=t,this._height=e,this.target?this.target.size(t,e):this.target=Nt.create(t,e),this.target.hasListener("recovered")||this.target.on("recovered",this,function(t){T.timer.callLater(i._sp,i._sp.repaint)})):this.target.size(t,e)},e._flushToTarget=function(t,e){if(!e._destroy){var i=vt.worldScissorTest,r=vt.worldClipRect;vt.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,vt.worldScissorTest=!1,bt.mainContext.disable(3089);var s=vt.worldAlpha,a=vt.worldMatrix4,n=vt.worldMatrix,h=vt.worldFilters,l=vt.worldShaderDefines;if(vt.worldMatrix=S.EMPTY,vt.restoreTempArray(),vt.worldMatrix4=vt.TEMPMAT4_ARRAY,vt.worldAlpha=1,vt.worldFilters=null,vt.worldShaderDefines=null,Bt.activeShader=null,e.start(),A.showCanvasMark?e.clear(0,1,0,.3):e.clear(0,0,0,0),t.flush(),e.end(),Bt.activeShader=null,vt.worldAlpha=s,vt.worldMatrix4=a,vt.worldMatrix=n,vt.worldFilters=h,vt.worldShaderDefines=l,vt.worldScissorTest=i){var o=vt.height-r.y-r.height;bt.mainContext.scissor(r.x,o,r.width,r.height),bt.mainContext.enable(3089)}vt.worldClipRect=r}},e.flush=function(t){this.repaint&&(this._flushToTarget(t,this.target),this.repaint=!1)},e.drawTo=function(t,e,i,r,s){t.drawTexture(this.target.getTexture(),e,i,r,s,0,0)},e.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},t}(),$=function(){function t(){this.ALPHA=1,this.shaderType=0,this.defines=new It}return c(t,"laya.webgl.shader.d2.Shader2D"),t.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},t.__init__=function(){var t,e;Qt.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),Qt.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),Qt.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),Qt.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4Color += texture2D(texture, v_texcoord + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),Qt.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),Qt.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),Qt.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),Qt.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),t="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",e='precision mediump float;\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',Qt.preCompile2D(0,1,t,e,null),t="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",e='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',Qt.preCompile2D(0,2,t,e,null),t="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",e="precision mediump float;\n//precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",Qt.preCompile2D(0,4,t,e,null),t="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",e='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',Qt.preCompile2D(0,256,t,e,null),t="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",e="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",Qt.preCompile2D(0,512,t,e,null)},t}(),J=function(){function e(t,e,i){this._value=0,this._name2int=t,this._int2name=e,this._int2nameMap=i}c(e,"laya.webgl.shader.ShaderDefines");var t=e.prototype;return t.add=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value|=t,this._value},t.addInt=function(t){return this._value|=t,this._value},t.remove=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value&=~t,this._value},t.isDefine=function(t){return(this._value&t)===t},t.getValue=function(){return this._value},t.setValue=function(t){this._value=t},t.toNameDic=function(){var t=this._int2nameMap[this._value];return t||e._toText(this._value,this._int2name,this._int2nameMap)},e._reg=function(t,e,i,r){r[i[t]=e]=t},e._toText=function(t,e,i){var r=i[t];if(r)return r;for(var s={},a=1,n=0;n<32&&!(t<(a=1<<n));n++)if(t&a){var h=e[a];h&&(s[h]="")}return i[t]=s},e._toInt=function(t,e){for(var i=t.split("."),r=0,s=0,a=i.length;s<a;s++){var n=e[i[s]];if(!n)throw new Error("Defines to int err:"+t+"/"+i[s]);r|=n}return r},e}(),tt=function(){function n(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new S}c(n,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var t=n.prototype;return t.init=function(t,e,i){if(e)this._vs=e;else{this._vs=[];var r=t.width,s=t.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push(r,0,1,0,1,1,1,1),this._vs.push(r,s,1,1,1,1,1,1),this._vs.push(0,s,0,1,1,1,1,1)}this._ps=i||(n._defaultPS||(n._defaultPS=[]).push(0,1,3,3,1,2),n._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=t},t.init2=function(t,e,i,r,s){this.transform&&(this.transform=null),i?this._ps=i:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=r,this._uvs=s,this.mEleNum=this._ps.length,this.mTexture=t,(g.isConchNode||g.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},t._initMyData=function(){var t=0,e=0,i=4*this._verticles.length;this._vs=n._tempVS;var r=!1;if(g.isConchNode||g.isConchApp?(this._vs.length=i,r=!0):this._vs.length<i&&(this._vs.length=i,r=!0),n._tVSLen=i,r)for(;t<i;)this._vs[t]=this._verticles[e],this._vs[t+1]=this._verticles[e+1],this._vs[t+2]=this._uvs[e],this._vs[t+3]=this._uvs[e+1],this._vs[t+4]=1,this._vs[t+5]=1,this._vs[t+6]=1,this._vs[t+7]=1,t+=8,e+=2;else for(;t<i;)this._vs[t]=this._verticles[e],this._vs[t+1]=this._verticles[e+1],this._vs[t+2]=this._uvs[e],this._vs[t+3]=this._uvs[e+1],t+=8,e+=2},t.getData2=function(t,e,i){var r;this.mVBBuffer=t,this.mIBBuffer=e,this._initMyData(),t.appendEx2(this._vs,Float32Array,n._tVSLen,4),this._indexStart=e._byteLength,(r=n._tempIB).length<this._ps.length&&(r.length=this._ps.length);for(var s=0,a=this._ps.length;s<a;s++)r[s]=this._ps[s]+i;e.appendEx2(r,Uint16Array,this._ps.length,2)},t.getData=function(t,e,i){if(this.mVBBuffer=t,this.mIBBuffer=e,t.append(this.mVBData),this._indexStart=e._byteLength,this.mIBData.start!=i){for(var r=0,s=this._ps.length;r<s;r++)this.mIBData[r]=this._ps[r]+i;this.mIBData.start=i}e.append(this.mIBData)},t.render=function(t,e,i){if(g.isWebGL&&this.mTexture){t._renderKey=0,t._shader2D.glTexture=null,et.getInstance().addSkinMesh(this);var r=at.createShape(t,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,Et.create(512,0));this.transform||(this.transform=S.EMPTY),this.transform.translate(e,i),S.mul(this.transform,t._curMat,this._tempMatrix),this.transform.translate(-e,-i);var s=r.shaderValue,a=s.u_mmat2||vt.getMatrArray();vt.mat2MatArray(this._tempMatrix,a),s.textureHost=this.mTexture,s.offsetX=0,s.offsetY=0,s.u_mmat2=a,s.ALPHA=t._shader2D.ALPHA,t._submits[t._submits._length++]=r}else g.isConchApp&&this.mTexture&&(this.transform||(this.transform=S.EMPTY),t.setSkinMesh&&t.setSkinMesh(e,i,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},n._tempVS=[],n._tempIB=[],n._defaultPS=null,n._tVSLen=0,n}(),et=function(){function t(){this.ib=null,this.vb=null;bt.mainContext;this.ib=$t.create(35048),this.vb=Jt.create(8)}c(t,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var e=t.prototype;return e.addSkinMesh=function(t){t.getData2(this.vb,this.ib,this.vb._byteLength/32)},e.reset=function(){this.vb.clear(),this.ib.clear()},t.getInstance=function(){return t.instance=t.instance||new t},t.instance=null,t}(),it=function(){function t(t,e,i,r,s,a,n,h,l){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===l&&(l=0),this.x=t,this.y=e,this.width=i,this.height=r,this.edges=s,this.color=a,this.borderWidth=n,this.borderColor=h}c(t,"laya.webgl.shapes.BasePoly");var e=t.prototype;return T.imps(e,{"laya.webgl.shapes.IShape":!0}),e.getData=function(t,e,i){},e.rebuild=function(t){},e.setMatrix=function(t){},e.needUpdate=function(t){return!0},e.sector=function(t,e,i){var r=this.x,s=this.y,a=this.edges,n=(this.r1-this.r0)/a,h=this.width,l=this.height,o=this.color,u=(o>>16&255)/255,_=(o>>8&255)/255,c=(255&o)/255;t.push(r,s,u,_,c);for(var f=0;f<a+1;f++)t.push(r+Math.sin(n*f+this.r0)*h,s+Math.cos(n*f+this.r0)*l),t.push(u,_,c);for(f=0;f<a;f++)e.push(i,i+f+1,i+f+2)},e.createLine2=function(t,e,i,r,s,a){var n,h,l,o,u,_,c,f,d,m,p,g,v,x,b,y,T,A,E,S,w=t.concat(),R=s,I=this.borderColor,M=(I>>16&255)/255,C=(I>>8&255)/255,L=(255&I)/255,P=w.length/2,D=r,F=i/2;l=w[0],o=w[1],m=l-(u=w[2]),d=(d=-(o-(_=w[3])))/(S=Math.sqrt(d*d+m*m))*F,m=m/S*F,R.push(l-d+this.x,o-m+this.y,M,C,L,l+d+this.x,o+m+this.y,M,C,L);for(var B=1;B<P-1;B++)l=w[2*(B-1)],o=w[2*(B-1)+1],u=w[2*B],_=w[2*B+1],c=w[2*(B+1)],f=w[2*(B+1)+1],m=l-u,g=u-c,b=(-(d=(d=-(o-_))/(S=Math.sqrt(d*d+m*m))*F)+l)*(-(m=m/S*F)+_)-(-d+u)*(-m+o),A=(-(p=(p=-(_-f))/(S=Math.sqrt(p*p+g*g))*F)+c)*(-(g=g/S*F)+_)-(-p+u)*(-g+f),E=(v=-m+o-(-m+_))*(T=-p+u-(-p+c))-(y=-g+f-(-g+_))*(x=-d+u-(-d+l)),Math.abs(E)<.1?(E+=10.1,R.push(u-d+this.x,_-m+this.y,M,C,L,u+d+this.x,_+m+this.y,M,C,L)):(((n=(x*A-T*b)/E)-u)*(n-u)+((h=(y*b-v*A)/E)-_)+(h-_),R.push(n+this.x,h+this.y,M,C,L,u-(n-u)+this.x,_-(h-_)+this.y,M,C,L));l=w[w.length-4],o=w[w.length-3],m=l-(u=w[w.length-2]),d=(d=-(o-(_=w[w.length-1])))/(S=Math.sqrt(d*d+m*m))*F,m=m/S*F,R.push(u-d+this.x,_-m+this.y,M,C,L,u+d+this.x,_+m+this.y,M,C,L);var N=a;for(B=1;B<N;B++)e.push(D+2*(B-1),D+2*(B-1)+1,D+2*B+1,D+2*B+1,D+2*B,D+2*(B-1));return R},e.createLine=function(t,e,i,r){var s=t.concat(),a=t,n=this.borderColor,h=(n>>16&255)/255,l=(n>>8&255)/255,o=(255&n)/255;s.splice(0,5);var u,_,c,f,d,m,p,g,v,x,b,y,T,A,E,S,w,R,I,M,C=s.length/5,L=r,P=i/2;c=s[0],f=s[1],x=c-(d=s[5]),v=(v=-(f-(m=s[6])))/(M=Math.sqrt(v*v+x*x))*P,x=x/M*P,a.push(c-v,f-x,h,l,o,c+v,f+x,h,l,o);for(var D=1;D<C-1;D++)c=s[5*(D-1)],f=s[5*(D-1)+1],d=s[5*D],m=s[5*D+1],p=s[5*(D+1)],g=s[5*(D+1)+1],x=c-d,y=d-p,E=(-(v=(v=-(f-m))/(M=Math.sqrt(v*v+x*x))*P)+c)*(-(x=x/M*P)+m)-(-v+d)*(-x+f),R=(-(b=(b=-(m-g))/(M=Math.sqrt(b*b+y*y))*P)+p)*(-(y=y/M*P)+m)-(-b+d)*(-y+g),I=(T=-x+f-(-x+m))*(w=-b+d-(-b+p))-(S=-y+g-(-y+m))*(A=-v+d-(-v+c)),Math.abs(I)<.1?(I+=10.1,a.push(d-v,m-x,h,l,o,d+v,m+x,h,l,o)):(((u=(A*R-w*E)/I)-d)*(u-d)+((_=(S*E-T*R)/I)-m)+(_-m),a.push(u,_,h,l,o,d-(u-d),m-(_-m),h,l,o));c=s[s.length-10],f=s[s.length-9],x=c-(d=s[s.length-5]),v=(v=-(f-(m=s[s.length-4])))/(M=Math.sqrt(v*v+x*x))*P,x=x/M*P,a.push(d-v,m-x,h,l,o,d+v,m+x,h,l,o);var F=this.edges+1;for(D=1;D<F;D++)e.push(L+2*(D-1),L+2*(D-1)+1,L+2*D+1,L+2*D+1,L+2*D,L+2*(D-1));return a},e.createLoopLine=function(t,e,i,r,s,a){var n=t.concat(),h=s||t,l=this.borderColor,o=(l>>16&255)/255,u=(l>>8&255)/255,_=(255&l)/255;n.splice(0,5);var c=[n[0],n[1]],f=[n[n.length-5],n[n.length-4]],d=f[0]+.5*(c[0]-f[0]),m=f[1]+.5*(c[1]-f[1]);n.unshift(d,m,0,0,0),n.push(d,m,0,0,0);var p,g,v,x,b,y,T,A,E,S,w,R,I,M,C,L,P,D,F,B,N=n.length/5,O=r,V=i/2;v=n[0],x=n[1],S=v-(b=n[5]),E=(E=-(x-(y=n[6])))/(B=Math.sqrt(E*E+S*S))*V,S=S/B*V,h.push(v-E,x-S,o,u,_,v+E,x+S,o,u,_);for(var U=1;U<N-1;U++)v=n[5*(U-1)],x=n[5*(U-1)+1],b=n[5*U],y=n[5*U+1],T=n[5*(U+1)],A=n[5*(U+1)+1],S=v-b,R=b-T,C=(-(E=(E=-(x-y))/(B=Math.sqrt(E*E+S*S))*V)+v)*(-(S=S/B*V)+y)-(-E+b)*(-S+x),D=(-(w=(w=-(y-A))/(B=Math.sqrt(w*w+R*R))*V)+T)*(-(R=R/B*V)+y)-(-w+b)*(-R+A),F=(I=-S+x-(-S+y))*(P=-w+b-(-w+T))-(L=-R+A-(-R+y))*(M=-E+b-(-E+v)),Math.abs(F)<.1?(F+=10.1,h.push(b-E,y-S,o,u,_,b+E,y+S,o,u,_)):(((p=(M*D-P*C)/F)-b)*(p-b)+((g=(L*C-I*D)/F)-y)+(g-y),h.push(p,g,o,u,_,b-(p-b),y-(g-y),o,u,_));a&&(e=a);var k=this.edges+1;for(U=1;U<k;U++)e.push(O+2*(U-1),O+2*(U-1)+1,O+2*U+1,O+2*U+1,O+2*U,O+2*(U-1));return e.push(O+2*(U-1),O+2*(U-1)+1,O+1,O+1,O,O+2*(U-1)),h},t}(),rt=function(){function m(){}return c(m,"laya.webgl.shapes.Earcut"),m.earcut=function(t,e,i){i=i||2;var r,s,a,n,h,l,o,u=e&&e.length,_=u?e[0]*i:t.length,c=m.linkedList(t,0,_,i,!0),f=[];if(!c)return f;if(u&&(c=m.eliminateHoles(t,e,c,i)),t.length>80*i){r=a=t[0],s=n=t[1];for(var d=i;d<_;d+=i)(h=t[d])<r&&(r=h),(l=t[d+1])<s&&(s=l),a<h&&(a=h),n<l&&(n=l);o=0!==(o=Math.max(a-r,n-s))?1/o:0}return m.earcutLinked(c,f,i,r,s,o),f},m.linkedList=function(t,e,i,r,s){var a,n;if(s===0<m.signedArea(t,e,i,r))for(a=e;a<i;a+=r)n=m.insertNode(a,t[a],t[a+1],n);else for(a=i-r;e<=a;a-=r)n=m.insertNode(a,t[a],t[a+1],n);return n&&m.equals(n,n.next)&&(m.removeNode(n),n=n.next),n},m.filterPoints=function(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!m.equals(r,r.next)&&0!==m.area(r.prev,r,r.next))r=r.next;else{if(m.removeNode(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e},m.earcutLinked=function(t,e,i,r,s,a,n){if(t){!n&&a&&m.indexCurve(t,r,s,a);for(var h,l,o=t;t.prev!==t.next;)if(h=t.prev,l=t.next,a?m.isEarHashed(t,r,s,a):m.isEar(t))e.push(h.i/i),e.push(t.i/i),e.push(l.i/i),m.removeNode(t),t=l.next,o=l.next;else if((t=l)===o){n?1===n?(t=m.cureLocalIntersections(t,e,i),m.earcutLinked(t,e,i,r,s,a,2)):2===n&&m.splitEarcut(t,e,i,r,s,a):m.earcutLinked(m.filterPoints(t,null),e,i,r,s,a,1);break}}},m.isEar=function(t){var e=t.prev,i=t,r=t.next;if(0<=m.area(e,i,r))return!1;for(var s=t.next.next;s!==t.prev;){if(m.pointInTriangle(e.x,e.y,i.x,i.y,r.x,r.y,s.x,s.y)&&0<=m.area(s.prev,s,s.next))return!1;s=s.next}return!0},m.isEarHashed=function(t,e,i,r){var s=t.prev,a=t,n=t.next;if(0<=m.area(s,a,n))return!1;for(var h=s.x<a.x?s.x<n.x?s.x:n.x:a.x<n.x?a.x:n.x,l=s.y<a.y?s.y<n.y?s.y:n.y:a.y<n.y?a.y:n.y,o=s.x>a.x?s.x>n.x?s.x:n.x:a.x>n.x?a.x:n.x,u=s.y>a.y?s.y>n.y?s.y:n.y:a.y>n.y?a.y:n.y,_=m.zOrder(h,l,e,i,r),c=m.zOrder(o,u,e,i,r),f=t.nextZ;f&&f.z<=c;){if(f!==t.prev&&f!==t.next&&m.pointInTriangle(s.x,s.y,a.x,a.y,n.x,n.y,f.x,f.y)&&0<=m.area(f.prev,f,f.next))return!1;f=f.nextZ}for(f=t.prevZ;f&&f.z>=_;){if(f!==t.prev&&f!==t.next&&m.pointInTriangle(s.x,s.y,a.x,a.y,n.x,n.y,f.x,f.y)&&0<=m.area(f.prev,f,f.next))return!1;f=f.prevZ}return!0},m.cureLocalIntersections=function(t,e,i){var r=t;do{var s=r.prev,a=r.next.next;!m.equals(s,a)&&m.intersects(s,r,r.next,a)&&m.locallyInside(s,a)&&m.locallyInside(a,s)&&(e.push(s.i/i),e.push(r.i/i),e.push(a.i/i),m.removeNode(r),m.removeNode(r.next),r=t=a),r=r.next}while(r!==t);return r},m.splitEarcut=function(t,e,i,r,s,a){var n=t;do{for(var h=n.next.next;h!==n.prev;){if(n.i!==h.i&&m.isValidDiagonal(n,h)){var l=m.splitPolygon(n,h);return n=m.filterPoints(n,n.next),l=m.filterPoints(l,l.next),m.earcutLinked(n,e,i,r,s,a),void m.earcutLinked(l,e,i,r,s,a)}h=h.next}n=n.next}while(n!==t)},m.eliminateHoles=function(t,e,i,r){var s,a,n,h,l,o=[];for(s=0,a=e.length;s<a;s++)n=e[s]*r,h=s<a-1?e[s+1]*r:t.length,(l=m.linkedList(t,n,h,r,!1))===l.next&&(l.steiner=!0),o.push(m.getLeftmost(l));for(o.sort(m.compareX),s=0;s<o.length;s++)m.eliminateHole(o[s],i),i=m.filterPoints(i,i.next);return i},m.compareX=function(t,e){return t.x-e.x},m.eliminateHole=function(t,e){if(e=m.findHoleBridge(t,e)){var i=m.splitPolygon(e,t);m.filterPoints(i,i.next)}},m.findHoleBridge=function(t,e){var i,r=e,s=t.x,a=t.y,n=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var h=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(h<=s&&n<h){if((n=h)===s){if(a===r.y)return r;if(a===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!i)return null;if(s===n)return i.prev;var l,o=i,u=i.x,_=i.y,c=1/0;for(r=i.next;r!==o;)s>=r.x&&r.x>=u&&s!==r.x&&m.pointInTriangle(a<_?s:n,a,u,_,a<_?n:s,a,r.x,r.y)&&((l=Math.abs(a-r.y)/(s-r.x))<c||l===c&&r.x>i.x)&&m.locallyInside(r,t)&&(i=r,c=l),r=r.next;return i},m.indexCurve=function(t,e,i,r){for(var s=t;null===s.z&&(s.z=m.zOrder(s.x,s.y,e,i,r)),s.prevZ=s.prev,s.nextZ=s.next,(s=s.next)!==t;);s.prevZ.nextZ=null,s.prevZ=null,m.sortLinked(s)},m.sortLinked=function(t){var e,i,r,s,a,n,h,l,o=1;do{for(i=t,a=t=null,n=0;i;){for(n++,r=i,e=h=0;e<o&&(h++,r=r.nextZ);e++);for(l=o;0<h||0<l&&r;)0!==h&&(0===l||!r||i.z<=r.z)?(i=(s=i).nextZ,h--):(r=(s=r).nextZ,l--),a?a.nextZ=s:t=s,s.prevZ=a,a=s;i=r}a.nextZ=null,o*=2}while(1<n);return t},m.zOrder=function(t,e,i,r,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*s)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*s)|e<<8))|e<<4))|e<<2))|e<<1))<<1},m.getLeftmost=function(t){for(var e=t,i=t;e.x<i.x&&(i=e),(e=e.next)!==t;);return i},m.pointInTriangle=function(t,e,i,r,s,a,n,h){return 0<=(s-n)*(e-h)-(t-n)*(a-h)&&0<=(t-n)*(r-h)-(i-n)*(e-h)&&0<=(i-n)*(a-h)-(s-n)*(r-h)},m.isValidDiagonal=function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!m.intersectsPolygon(t,e)&&m.locallyInside(t,e)&&m.locallyInside(e,t)&&m.middleInside(t,e)},m.area=function(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)},m.equals=function(t,e){return t.x===e.x&&t.y===e.y},m.intersects=function(t,e,i,r){return!!(m.equals(t,e)&&m.equals(i,r)||m.equals(t,r)&&m.equals(i,e))||0<m.area(t,e,i)!=0<m.area(t,e,r)&&0<m.area(i,r,t)!=0<m.area(i,r,e)},m.intersectsPolygon=function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&m.intersects(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1},m.locallyInside=function(t,e){return m.area(t.prev,t,t.next)<0?0<=m.area(t,e,t.next)&&0<=m.area(t,t.prev,e):m.area(t,e,t.prev)<0||m.area(t,t.next,e)<0},m.middleInside=function(t,e){for(var i=t,r=!1,s=(t.x+e.x)/2,a=(t.y+e.y)/2;i.y>a!=i.next.y>a&&i.next.y!==i.y&&s<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),(i=i.next)!==t;);return r},m.splitPolygon=function(t,e){var i=new st(t.i,t.x,t.y),r=new st(e.i,e.x,e.y),s=t.next,a=e.prev;return(t.next=e).prev=t,(i.next=s).prev=i,(r.next=i).prev=r,(a.next=r).prev=a,r},m.insertNode=function(t,e,i,r){var s=new st(t,e,i);return r?(s.next=r.next,(s.prev=r).next.prev=s,r.next=s):(s.prev=s).next=s,s},m.removeNode=function(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)},m.signedArea=function(t,e,i,r){for(var s=0,a=e,n=i-r;a<i;a+=r)s+=(t[n]-t[a])*(t[a+1]+t[n+1]),n=a;return s},m}(),st=function(){function t(t,e,i){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return c(t,"laya.webgl.shapes.EarcutNode"),t}(),at=(function(){function t(t,e,i,r,s,a,n){this.lineWidth=t,this.lineColor=e,this.lineAlpha=i,this.fillColor=r,this.fillAlpha=s,this.shape=n,this.fill=a}c(t,"laya.webgl.shapes.GeometryData");var e=t.prototype;e.clone=function(){return new t(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},e.getIndexData=function(){return null},e.getVertexData=function(){return null},e.destroy=function(){this.shape=null}}(),function(){function t(t){if(t instanceof Float32Array)this.points=t;else if(t instanceof Array){t.length;this.points=new Float32Array(t)}}c(t,"laya.webgl.shapes.Vertex");var e=t.prototype;T.imps(e,{"laya.webgl.shapes.IShape":!0}),e.getData=function(t,e,i){},e.needUpdate=function(t){return!1},e.rebuild=function(t){},e.setMatrix=function(t){}}(),function(){function l(t){void 0===t&&(t=1e4),this._renderType=t}c(l,"laya.webgl.submit.Submit");var t=l.prototype;return T.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.releaseRender=function(){var t=l._cache;(t[t._length++]=this).shaderValue.release(),this._vb=null},t.getRenderType=function(){return this._renderType},t.renderSubmit=function(){if(0===this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t.source;if(!t.bitmap||!e)return 1;this.shaderValue.texture=e}this._vb.bind_upload(this._ib);var i=bt.mainContext;return this.shaderValue.upload(),G.activeBlendFunction!==this._blendFn&&(i.enable(3042),this._blendFn(i),G.activeBlendFunction=this._blendFn),C.drawCall++,C.trianglesFaces+=this._numEle/3,i.drawElements(4,this._numEle,5123,this._startIdx),1},l.__init__=function(){var t=l.RENDERBASE=new l(-1);t.shaderValue=new Et(0,0),t.shaderValue.ALPHA=-1234},l.createSubmit=function(t,e,i,r,s){var a=l._cache._length?l._cache[--l._cache._length]:new l;null==i&&((i=a._selfVb||(a._selfVb=Jt.create(-1))).clear(),r=0),a._ib=e,a._vb=i,a._startIdx=r*mt.BYTES_PIDX,a._numEle=0;var n=t._nBlendType;a._blendFn=t._targets?G.targetFns[n]:G.fns[n],a.shaderValue=s,a.shaderValue.setValue(t._shader2D);var h=t._shader2D.filters;return h&&a.shaderValue.setFilters(h),a},l.createShape=function(t,e,i,r,s,a){var n=l._cache._length?l._cache[--l._cache._length]:new l;n._ib=e,n._vb=i,n._numEle=r,n._startIdx=s,n.shaderValue=a,n.shaderValue.setValue(t._shader2D);var h=t._nBlendType;return n._blendFn=t._targets?G.targetFns[h]:G.fns[h],n},l.TYPE_2D=1e4,l.TYPE_CANVAS=10003,l.TYPE_CMDSETRT=10004,l.TYPE_CUSTOM=10005,l.TYPE_BLURRT=10006,l.TYPE_CMDDESTORYPRERT=10007,l.TYPE_DISABLESTENCIL=10008,l.TYPE_OTHERIBVB=10009,l.TYPE_PRIMITIVE=10010,l.TYPE_RT=10011,l.TYPE_BLUR_RT=10012,l.TYPE_TARGET=10013,l.TYPE_CHANGE_VALUE=10014,l.TYPE_SHAPE=10015,l.TYPE_TEXTURE=10016,l.TYPE_FILLTEXTURE=10017,l.RENDERBASE=null,l._cache=((l._cache=[])._length=0,l._cache),l}()),nt=function(){function r(){this.fun=null,this.args=null}c(r,"laya.webgl.submit.SubmitCMD");var t=r.prototype;return T.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){return this.fun.apply(null,this.args),1},t.getRenderType=function(){return 0},t.releaseRender=function(){var t=r._cache;t[t._length++]=this},r.create=function(t,e){var i=r._cache._length?r._cache[--r._cache._length]:new r;return i.fun=e,i.args=t,i},r._cache=((r._cache=[])._length=0,r._cache),r}(),ht=function(){function e(){this.variables={}}c(e,"laya.webgl.submit.SubmitCMDScope");var t=e.prototype;return t.getValue=function(t){return this.variables[t]},t.addValue=function(t,e){return this.variables[t]=e},t.setValue=function(t,e){return this.variables.hasOwnProperty(t)?this.variables[t]=e:null},t.clear=function(){for(var t in this.variables)delete this.variables[t]},t.recycle=function(){this.clear(),e.POOL.push(this)},e.create=function(){var t=e.POOL.pop();return t||(t=new e),t},e.POOL=[],e}(),lt=function(){function _(){this.offset=0,this.startIndex=0,this._mat=S.create()}c(_,"laya.webgl.submit.SubmitOtherIBVB");var t=_.prototype;return T.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.releaseRender=function(){var t=_._cache;t[t._length++]=this},t.getRenderType=function(){return 10009},t.renderSubmit=function(){var t=this._shaderValue.textureHost;if(t){var e=t.source;if(!t.bitmap||!e)return 1;this._shaderValue.texture=e}this._vb.bind_upload(this._ib);var i=vt.worldMatrix4,r=S.TEMP;S.mulPre(this._mat,i[0],i[1],i[4],i[5],i[12],i[13],r);var s=vt.worldMatrix4=_.tempMatrix4;s[0]=r.a,s[1]=r.b,s[4]=r.c,s[5]=r.d,s[12]=r.tx,s[13]=r.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var a=bt.mainContext;return G.activeBlendFunction!==this._blendFn&&(a.enable(3042),this._blendFn(a),G.activeBlendFunction=this._blendFn),C.drawCall++,C.trianglesFaces+=this._numEle/3,a.drawElements(4,this._numEle,5123,this.startIndex),vt.worldMatrix4=i,Bt.activeShader=null,1},_.create=function(t,e,i,r,s,a,n,h,l){void 0===l&&(l=0);var o=_._cache._length?_._cache[--_._cache._length]:new _;o._ib=i,o._vb=e,o._numEle=r,o._shader=s,o._shaderValue=a;var u=t._nBlendType;switch(o._blendFn=t._targets?G.targetFns[u]:G.fns[u],l){case 0:o.offset=0,o.startIndex=h/(mt.BYTES_PE*e.vertexStride)*1.5,o.startIndex*=mt.BYTES_PIDX;break;case 1:o.startIndex=n,o.offset=h}return o},_._cache=((_._cache=[])._length=0,_._cache),_.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_}(),ot=function(){function i(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new R,this.screenRect=new R}c(i,"laya.webgl.submit.SubmitScissor");var t=i.prototype;return T.imps(t,{"laya.webgl.submit.ISubmit":!0}),t._scissor=function(t,e,i,r){var s=vt.worldMatrix4,a=s[0],n=s[5],h=s[12],l=s[13];if(r*=n,(i*=a)<1||r<1)return!1;var o=(t=t*a+h)+i,u=(e=e*n+l)+r;t<0&&(i=o-(t=0)),e<0&&(r=u-(e=0));var _=vt.worldClipRect;if(t=Math.max(t,_.x),e=Math.max(e,_.y),i=Math.min(o,_.right)-t,r=Math.min(u,_.bottom)-e,i<1||r<1)return!1;var c=vt.worldScissorTest;return this.screenRect.copyFrom(_),_.x=t,_.y=e,_.width=i,_.height=r,vt.worldScissorTest=!0,e=vt.height-e-r,bt.mainContext.scissor(t,e,i,r),bt.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),c?(e=vt.height-this.screenRect.y-this.screenRect.height,bt.mainContext.scissor(this.screenRect.x,e,this.screenRect.width,this.screenRect.height),bt.mainContext.enable(3089)):(bt.mainContext.disable(3089),vt.worldScissorTest=!1),_.copyFrom(this.screenRect),!0},t._scissorWithTagart=function(t,e,i,r){if(i<1||r<1)return!1;var s=t+i,a=e+r;t<0&&(i=s-(t=0)),e<0&&(r=a-(e=0));var n=vt.worldClipRect;if(t=Math.max(t,n.x),e=Math.max(e,n.y),i=Math.min(s,n.right)-t,r=Math.min(a,n.bottom)-e,i<1||r<1)return!1;var h=vt.worldScissorTest;return this.screenRect.copyFrom(n),vt.worldScissorTest=!0,n.x=t,n.y=e,n.width=i,n.height=r,e=vt.height-e-r,bt.mainContext.scissor(t,e,i,r),bt.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),h?(e=vt.height-this.screenRect.y-this.screenRect.height,bt.mainContext.scissor(this.screenRect.x,e,this.screenRect.width,this.screenRect.height),bt.mainContext.enable(3089)):(bt.mainContext.disable(3089),vt.worldScissorTest=!1),n.copyFrom(this.screenRect),!0},t.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},t.getRenderType=function(){return 0},t.releaseRender=function(){var t=i._cache;(t[t._length++]=this).context=null},i.create=function(t){var e=i._cache._length?i._cache[--i._cache._length]:new i;return e.context=t,e},i._cache=((i._cache=[])._length=0,i._cache),i}(),ut=function(){function l(){this.step=0,this.blendMode=null,this.level=0}c(l,"laya.webgl.submit.SubmitStencil");var t=l.prototype;return T.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},t.getRenderType=function(){return 0},t.releaseRender=function(){var t=l._cache;t[t._length++]=this},t.do1=function(){var t=bt.mainContext;t.enable(2960),t.clear(1024),t.colorMask(!1,!1,!1,!1),t.stencilFunc(514,this.level,255),t.stencilOp(7680,7680,7682)},t.do2=function(){var t=bt.mainContext;t.stencilFunc(514,this.level+1,255),t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680)},t.do3=function(){var t=bt.mainContext;t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680),t.clear(1024),t.disable(2960)},t.do4=function(){var t=bt.mainContext;0==this.level&&(t.enable(2960),t.clear(1024)),t.colorMask(!1,!1,!1,!1),t.stencilFunc(519,0,255),t.stencilOp(7680,7680,7682)},t.do5=function(){var t=bt.mainContext;t.stencilFunc(514,this.level,255),t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680)},t.do6=function(){var t=bt.mainContext;G.targetFns[G.TOINT[this.blendMode]](t)},t.do7=function(){var t=bt.mainContext;t.colorMask(!1,!1,!1,!1),t.stencilOp(7680,7680,7683)},t.do8=function(){var t=bt.mainContext;t.colorMask(!0,!0,!0,!0),t.stencilFunc(514,this.level,255),t.stencilOp(7680,7680,7680)},l.restore=function(t,e,i,r,s){var a;if((t._renderKey=0)<l._mask&&l._mask--,0==l._mask)a=laya.webgl.submit.SubmitStencil.create(3),t.addRenderObject(a),t._curSubmit=at.RENDERBASE;else{a=laya.webgl.submit.SubmitStencil.create(7),t.addRenderObject(a);var n=t._vb;n._byteLength;if(pt.fillRectImgVb(n,null,e.x,e.y,e.width,e.height,F.DEF_UV,i,r,s,0,0)){t._shader2D.glTexture=null;var h=t._curSubmit=at.createSubmit(t,t._ib,n,(n._byteLength-64)/32*3,Et.create(2,0));h.shaderValue.ALPHA=1,t._submits[t._submits._length++]=h,t._curSubmit._numEle+=6,t._curSubmit=at.RENDERBASE}else alert("clipRect calc stencil rect error");a=laya.webgl.submit.SubmitStencil.create(8),t.addRenderObject(a)}},l.restore2=function(t,e){var i;(t._renderKey=0)<l._mask&&l._mask--,0==l._mask?(i=laya.webgl.submit.SubmitStencil.create(3),t.addRenderObject(i),t._curSubmit=at.RENDERBASE):(i=laya.webgl.submit.SubmitStencil.create(7),t.addRenderObject(i),t._submits[t._submits._length++]=e,i=laya.webgl.submit.SubmitStencil.create(8),t.addRenderObject(i))},l.create=function(t){var e=l._cache._length?l._cache[--l._cache._length]:new l;return 5==(e.step=t)&&++l._mask,e.level=l._mask,e},l._cache=((l._cache=[])._length=0,l._cache),l._mask=0,l}(),_t=function(){function h(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}c(h,"laya.webgl.submit.SubmitTarget");var t=h.prototype;return T.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){this._vb.bind_upload(this._ib);var t=this.scope.getValue(this.proName);return t&&(this.shaderValue.texture=t.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[t.width,t.height]),this.shaderValue.upload(),this.blend(),C.drawCall++,C.trianglesFaces+=this._numEle/3,bt.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},t.blend=function(){if(G.activeBlendFunction!==G.fns[this.blendType]){var t=bt.mainContext;t.enable(3042),G.fns[this.blendType](t),G.activeBlendFunction=G.fns[this.blendType]}},t.getRenderType=function(){return 0},t.releaseRender=function(){var t=h._cache;t[t._length++]=this},h.create=function(t,e,i,r,s,a){var n=h._cache._length?h._cache[--h._cache._length]:new h;return n._ib=e,n._vb=i,n.proName=a,n._startIdx=r*mt.BYTES_PIDX,n._numEle=0,n.blendType=t._nBlendType,n.shaderValue=s,n.shaderValue.setValue(t._shader2D),n},h._cache=((h._cache=[])._length=0,h._cache),h}(),ct=function(){function t(){this._sourceStr=null}c(t,"laya.webgl.text.CharSegment");var e=t.prototype;return T.imps(e,{"laya.webgl.text.ICharSegment":!0}),e.textToSpit=function(t){this._sourceStr=t},e.getChar=function(t){return this._sourceStr.charAt(t)},e.getCharCode=function(t){return this._sourceStr.charCodeAt(t)},e.length=function(){return this._sourceStr.length},t}(),ft=function(){var t;function C(){}return c(C,"laya.webgl.text.DrawText"),C.__init__=function(){C._charsTemp=new Array,C._drawValue=new t,C._charSeg=new ct},C.customCharSeg=function(t){C._charSeg=t},C.getChar=function(t,e,i){var r=Yt.createOneChar(t,i);return-1!=e&&(C._charsCache[e]=r),r},C._drawSlow=function(t,e,i,r,s,a,n,h,l,o,u,_,c,f,d){var m,p,g=C._drawValue.value(a,h,l,o,c,f,d),v=0,x=0,b=C._charsTemp,y=0,T=NaN;if(r)for(b.length=r.length,v=0,x=r.length;v<x;v++)T=(p=r[v]).charNum+g.txtID,b[v]=m=C._charsCache[T]||C.getChar(p.char,T,g),m.active();else{var A=i instanceof laya.utils.WordText?i.toString():i;if(D.CharacterCache){C._charSeg.textToSpit(A);var E=C._charSeg.length();for(v=0,x=b.length=E;v<x;v++)T=C._charSeg.getCharCode(v)+g.txtID,b[v]=m=C._charsCache[T]||C.getChar(C._charSeg.getChar(v),T,g),m.active(),y+=m.cw}else b.length=0,(m=C.getChar(A,-1,g)).active(),y+=m.cw,b[0]=m}var S=0;null!==n&&"left"!==n&&(S=-("center"==n?y/2:y));var w,R,I=NaN,M=0;if(r)for(v=0,x=b.length;v<x;v++)(m=b[v]).isSpace||(p=r[v],I=m.borderSize,w=m.texture,e._drawText(w,u+S+p.x*c-I,_+p.y*f-I,w.width,w.height,s,0,0,0,0));else{for(v=0,x=b.length;v<x;v++)(m=b[v]).isSpace||(I=m.borderSize,w=m.texture,e._drawText(w,u+S-I,_-I,w.width,w.height,s,0,0,0,0),t&&((R=t[M++])||(R=t[M-1]=[]),R[0]=w,R[1]=S-I,R[2]=-I)),S+=m.cw;t&&(t.length=M)}},C._drawFast=function(t,e,i,r,s){for(var a,n,h=0,l=t.length;h<l;h++)(a=(n=t[h])[0]).active(),e._drawText(a,r+n[1],s+n[2],a.width,a.height,i,0,0,0,0)},C.drawText=function(t,e,i,r,s,a,n,h,l,o,u,_){if(void 0===_&&(_=0),!(e&&0===e.length||i&&0===i.length)){var c=r.a,f=r.d;(0!==r.b||0!==r.c)&&(c=f=1);var d=1!==c||1!==f;if(d&&T.stage.transform){var m=T.stage.transform;d=m.a===c&&m.d===f}else d=!1;if(d){var p=(r=r.copyTo(At._tmpMatrix)).tx,g=r.ty;r.scale(1/c,1/f),r._checkTransform(),o*=c,u*=f,o+=p-r.tx,u+=g-r.ty}else c=f=1;if(i)C._drawSlow(null,t,e,i,r,s,a,n,h,l,o,u,c,f,_);else{if(null===e.toUpperCase){var v=c+1e5*f,x=e;return void(x.changed||x.id!==v?(x.id=v,x.changed=!1,C._drawSlow(x.save,t,e,i,r,s,a,n,h,l,o,u,c,f,_)):C._drawFast(x.save,t,r,o,u))}var b=e+s.toString()+n+h+l+c+f+a,y=C._textsCache[b];D.CharacterCache?y?C._drawFast(y,t,r,o,u):(C._textsCache.__length||(C._textsCache.__length=0),C._textsCache.__length>A.WebGLTextCacheCount&&((C._textsCache={}).__length=0,C._curPoolIndex=0),C._textCachesPool[C._curPoolIndex]?(y=C._textsCache[b]=C._textCachesPool[C._curPoolIndex]).length=0:C._textCachesPool[C._curPoolIndex]=y=C._textsCache[b]=[],C._textsCache.__length++,C._curPoolIndex++,C._drawSlow(y,t,e,i,r,s,a,n,h,l,o,u,c,f,_)):C._drawSlow(y,t,e,i,r,s,a,n,h,l,o,u,c,f,_)}}},C._charsTemp=null,C._textCachesPool=[],C._curPoolIndex=0,C._charsCache={},C._textsCache={},C._drawValue=null,C.d=[],C._charSeg=null,C.__init$=function(){t=function(){function l(){}return c(l,""),l.prototype.value=function(t,e,i,r,s,a,n){this.font=t,this.fillColor=e,this.borderColor=i,this.lineWidth=r,this.scaleX=s,this.scaleY=a,this.underLine=n;var h=t.toString()+s+a+r+e+i+n;return this.txtID=l._keymap[h],this.txtID||(this.txtID=1e-7*++l._keymapCount,l._keymap[h]=this.txtID),this},l.clear=function(){l._keymap={},l._keymapCount=1},l._keymap={},l._keymapCount=1,l}()},C}(),dt=function(){function s(t){this._index=0,this._size=14,this._italic=-2,s._cache2=s._cache2||[],this.setFont(t||"14px Arial")}c(s,"laya.webgl.text.FontInContext");var t=s.prototype;return t.setFont=function(t){var e=s._cache2[t];if(e)this._words=e[0],this._size=e[1];else{this._words=t.split(" ");for(var i=0,r=this._words.length;i<r;i++)if(0<this._words[i].indexOf("px")){this._index=i;break}this._size=parseInt(this._words[this._index]),s._cache2[t]=[this._words,this._size]}this._text=null,this._italic=-2},t.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},t.hasType=function(t){for(var e=0,i=this._words.length;e<i;e++)if(this._words[e]===t)return e;return-1},t.removeType=function(t){for(var e=0,i=this._words.length;e<i;e++)if(this._words[e]===t){this._words.splice(e,1),this._index>e&&this._index--;break}this._text=null,this._italic=-2},t.copyTo=function(t){return t._text=this._text,t._size=this._size,t._index=this._index,t._words=this._words.slice(),t._italic=-2,t},t.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},r(0,t,"size",function(){return this._size},function(t){this._size=t,this._words[this._index]=t+"px",this._text=null}),s.create=function(t){var e=s._cache[t];return e||(e=s._cache[t]=new s(t))},s.EMPTY=new s,s._cache={},s._cache2=null,s}(),mt=function(){function t(){}return c(t,"laya.webgl.utils.CONST3D2D"),t.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],t.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],t._TMPARRAY=[],t._OFFSETX=0,t._OFFSETY=0,n(t,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),t}(),pt=function(){function d(){}return c(d,"laya.webgl.utils.GlUtils"),d.make2DProjection=function(t,e,i){return[2/t,0,0,0,0,-2/e,0,0,0,0,2/i,0,-1,1,0,1]},d.fillIBQuadrangle=function(t,e){if(65535/4<e)throw Error("IBQuadrangle count:"+e+" must<:"+Math.floor(65535/4));e=Math.floor(e),t._resizeBuffer(6*(e+1)*2,!1),t.byteLength=t.bufferLength;for(var i=t.getUint16Array(),r=0,s=0;s<e;s++)i[r++]=4*s,i[r++]=4*s+2,i[r++]=4*s+1,i[r++]=4*s,i[r++]=4*s+3,i[r++]=4*s+2;return t.setNeedUpload(),!0},d.expandIBQuadrangle=function(t,e){t.bufferLength>=6*e*2||d.fillIBQuadrangle(t,e)},d.mathCeilPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},d.fillQuadrangleImgVb=function(t,e,i,r,s,a,n,h){var l=16+(t._byteLength>>2);t.byteLength=l<<2;var o=t.getFloat32Array();o[(l-=16)+2]=s[0],o[l+3]=s[1],o[l+6]=s[2],o[l+7]=s[3],o[l+10]=s[4],o[l+11]=s[5],o[l+14]=s[6],o[l+15]=s[7];var u=a.a,_=a.b,c=a.c,f=a.d;if(1!==u||0!==_||0!==c||1!==f){a.bTransform=!0;var d=a.tx+n,m=a.ty+h;o[l]=(r[0]+e)*u+(r[1]+i)*c+d,o[l+1]=(r[0]+e)*_+(r[1]+i)*f+m,o[l+4]=(r[2]+e)*u+(r[3]+i)*c+d,o[l+5]=(r[2]+e)*_+(r[3]+i)*f+m,o[l+8]=(r[4]+e)*u+(r[5]+i)*c+d,o[l+9]=(r[4]+e)*_+(r[5]+i)*f+m,o[l+12]=(r[6]+e)*u+(r[7]+i)*c+d,o[l+13]=(r[6]+e)*_+(r[7]+i)*f+m}else a.bTransform=!1,e+=a.tx+n,i+=a.ty+h,o[l]=e+r[0],o[l+1]=i+r[1],o[l+4]=e+r[2],o[l+5]=i+r[3],o[l+8]=e+r[4],o[l+9]=i+r[5],o[l+12]=e+r[6],o[l+13]=i+r[7];return t._upload=!0},d.fillTranglesVB=function(t,e,i,r,s,a,n){var h=(t._byteLength>>2)+r.length;t.byteLength=h<<2;var l=t.getFloat32Array();h-=r.length;for(var o=r.length,u=s.a,_=s.b,c=s.c,f=s.d,d=0;d<o;d+=4)if(l[h+d+2]=r[d+2],l[h+d+3]=r[d+3],1!==u||0!==_||0!==c||1!==f){s.bTransform=!0;var m=s.tx+a,p=s.ty+n;l[h+d]=(r[d]+e)*u+(r[d+1]+i)*c+m,l[h+d+1]=(r[d]+e)*_+(r[d+1]+i)*f+p}else s.bTransform=!1,e+=s.tx+a,i+=s.ty+n,l[h+d]=e+r[d],l[h+d+1]=i+r[d+1];return t._upload=!0},d.copyPreImgVb=function(t,e,i){var r=t._byteLength>>2;t.byteLength=r+16<<2;for(var s=t.getFloat32Array(),a=0,n=r-16;a<4;a++)s[r]=s[n]+e,++n,s[++r]=s[n]+i,++n,s[++r]=s[n],++n,s[++r]=s[n],++r,++n;t._upload=!0},d.fillRectImgVb=function(t,e,i,r,s,a,n,h,l,o,u,_,c){void 0===c&&(c=!1);var f,d,m,p,g,v,x,b,y,T,A,E,S,w,R,I,M=1,C=h.a,L=h.b,P=h.c,D=h.d,F=e&&e.width<99999999;if(1!==C||0!==L||0!==P||1!==D?(h.bTransform=!0,0===L&&0===P&&(M=23,y=s+i,T=a+r,f=C*i+(A=h.tx+l),m=C*y+A,d=D*r+(E=h.ty+o),p=D*T+E)):(M=23,h.bTransform=!1,m=(f=i+h.tx+l)+s,p=(d=r+h.ty+o)+a),F&&(g=e.x,v=e.y,x=e.width+g,b=e.height+v),1!==M){if(Math.min(f,m)>=x)return!1;if(Math.min(d,p)>=b)return!1;if(Math.max(m,f)<=g)return!1;if(Math.max(p,d)<=v)return!1}var B=t._byteLength>>2;t.byteLength=B+16<<2;var N=t.getFloat32Array();switch(N[B+2]=n[0],N[B+3]=n[1],N[B+6]=n[2],N[B+7]=n[3],N[B+10]=n[4],N[B+11]=n[5],N[B+14]=n[6],N[B+15]=n[7],M){case 1:A=h.tx+l,E=h.ty+o;var O=C*i,V=P*r,U=D*r,k=L*i,H=C*(y=s+i),G=P*(T=a+r),z=D*T,W=L*y;N[B+13]=c?(S=O+V+A,R=Math.round(S)-S,w=U+k+E,I=Math.round(w)-w,N[B]=S+R,N[B+1]=w+I,N[B+4]=H+V+A+R,N[B+5]=U+W+E+I,N[B+8]=H+G+A+R,N[B+9]=z+W+E+I,N[B+12]=O+G+A+R,z+k+E+I):(N[B]=O+V+A,N[B+1]=U+k+E,N[B+4]=H+V+A,N[B+5]=U+W+E,N[B+8]=H+G+A,N[B+9]=z+W+E,N[B+12]=O+G+A,z+k+E);break;case 23:N[B+13]=c?(S=f+u,R=Math.round(S)-S,w=d,I=Math.round(w)-w,N[B]=S+R,N[B+1]=w+I,N[B+4]=m+u+R,N[B+5]=d+I,N[B+8]=m+R,N[B+9]=p+I,N[B+12]=f+R,p+I):(N[B]=f+u,N[B+1]=d,N[B+4]=m+u,N[B+5]=d,N[B+8]=m,N[B+9]=p,N[B+12]=f,p)}return t._upload=!0},d.fillLineVb=function(t,e,i,r,s,a,n,h){var l=.5*n,o=d._fillLineArray,u=-(r-a),_=i-s,c=Math.sqrt(u*u+_*_);u/=c,_/=c,u*=l,_*=l,o[0]=i-u,o[1]=r-_,o[4]=i+u,o[5]=r+_,o[8]=s+u,o[9]=a+_,o[12]=s-u,o[13]=a-_,h&&h.transformPointArray(o,o);var f=16+(t._byteLength>>2);return t.byteLength=f<<2,t.insertData(o,f-16),!0},d._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],d}(),gt=(function(){function l(){}c(l,"laya.webgl.utils.MatirxArray"),l.ArrayMul=function(t,e,i){if(t)if(e)for(var r=NaN,s=NaN,a=NaN,n=NaN,h=0;h<4;h++)r=t[h],s=t[h+4],a=t[h+8],n=t[h+12],i[h]=r*e[0]+s*e[1]+a*e[2]+n*e[3],i[h+4]=r*e[4]+s*e[5]+a*e[6]+n*e[7],i[h+8]=r*e[8]+s*e[9]+a*e[10]+n*e[11],i[h+12]=r*e[12]+s*e[13]+a*e[14]+n*e[15];else l.copyArray(t,i);else l.copyArray(e,i)},l.copyArray=function(t,e){if(t&&e)for(var i=0;i<t.length;i++)e[i]=t[i]}}(),function(){function e(t,e,i){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=t,this._vb=new Jt(t,35048),e&&this._vb._resizeBuffer(e,!1),this._ib=new $t,i&&this._ib._resizeBuffer(i,!1)}c(e,"laya.webgl.utils.Mesh2D");var t=e.prototype;return t.cloneWithNewVB=function(){var t=new e(this._stride,0,0);return t._ib=this._ib,t._quadNum=this._quadNum,t._attribInfo=this._attribInfo,t},t.cloneWithNewVBIB=function(){var t=new e(this._stride,0,0);return t._attribInfo=this._attribInfo,t},t.getVBW=function(){return this._vb.setNeedUpload(),this._vb},t.getVBR=function(){return this._vb},t.getIBR=function(){return this._ib},t.getIBW=function(){return this._ib.setNeedUpload(),this._ib},t.createQuadIB=function(t){this._quadNum=t,this._ib._resizeBuffer(6*t*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var e=this._ib.getUint16Array(),i=0,r=0,s=0;s<t;s++)e[i++]=r,e[i++]=r+2,e[i++]=r+1,e[i++]=r,e[i++]=r+3,e[i++]=r+2,r+=4;this._ib.setNeedUpload()},t.setAttributes=function(t){if(this._attribInfo=t,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},t.getEleNum=function(){return this._ib.getBuffer().byteLength/2},t.releaseMesh=function(){},t.destroy=function(){},t.clearVB=function(){this._vb.clear()},e._gvaoid=0,e}()),vt=function(){function s(){}return c(s,"laya.webgl.utils.RenderState2D"),s.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},s.mat2MatArray=function(t,e){var i=t,r=e;return r[0]=i.a,r[1]=i.b,r[2]=s.EMPTYMAT4_ARRAY[2],r[3]=s.EMPTYMAT4_ARRAY[3],r[4]=i.c,r[5]=i.d,r[6]=s.EMPTYMAT4_ARRAY[6],r[7]=s.EMPTYMAT4_ARRAY[7],r[8]=s.EMPTYMAT4_ARRAY[8],r[9]=s.EMPTYMAT4_ARRAY[9],r[10]=s.EMPTYMAT4_ARRAY[10],r[11]=s.EMPTYMAT4_ARRAY[11],r[12]=i.tx,r[13]=i.ty,r[14]=s.EMPTYMAT4_ARRAY[14],r[15]=s.EMPTYMAT4_ARRAY[15],e},s.restoreTempArray=function(){s.TEMPMAT4_ARRAY[0]=1,s.TEMPMAT4_ARRAY[1]=0,s.TEMPMAT4_ARRAY[4]=0,s.TEMPMAT4_ARRAY[5]=1,s.TEMPMAT4_ARRAY[12]=0,s.TEMPMAT4_ARRAY[13]=0},s.clear=function(){s.worldScissorTest=!1,s.worldShaderDefines=null,s.worldFilters=null,s.worldAlpha=1,s.worldClipRect.x=s.worldClipRect.y=0,s.worldClipRect.width=s.width,s.worldClipRect.height=s.height,s.curRenderTarget=null},s._MAXSIZE=99999999,s.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],s.worldMatrix4=s.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],s.worldAlpha=1,s.worldScissorTest=!1,s.worldFilters=null,s.worldShaderDefines=null,s.curRenderTarget=null,s.width=0,s.height=0,n(s,["worldMatrix",function(){return this.worldMatrix=new S},"worldClipRect",function(){return this.worldClipRect=new R(0,0,99999999,99999999)}]),s}(),xt=function(){var v,i;function x(t,e,i,r,s){var a=this;function n(t){var e=[],i=new v(e);return a._compileToTree(i,t.split("\n"),0,e,s),i}var h=f.now();this._VS=n(e),this._PS=n(i),this._nameMap=r,2<f.now()-h&&console.log("ShaderCompile use time:"+(f.now()-h)+"  size:"+e.length+"/"+i.length)}c(x,"laya.webgl.utils.ShaderCompile");var t=x.prototype;return t._compileToTree=function(t,e,i,r,s){var a,n,h,l,o,u,_,c=0,f=0,d=0,m=0;for(f=i;f<e.length;f++)if(!((h=e[f]).length<1)&&0!==(c=h.indexOf("//"))){if(0<=c&&(h=h.substr(0,c)),a=_||new v(r),_=null,a.text=h,a.noCompile=!0,0<=(c=h.indexOf("#"))){for(l="#",m=c+1,d=h.length;m<d;m++){var p=h.charAt(m);if(" "===p||"\t"===p||"?"===p)break;l+=p}switch(a.name=l){case"#ifdef":case"#ifndef":if(a.src=h,a.noCompile=null!=h.match(/[!&|()=<>]/),a.noCompile?console.log("function():Boolean{return "+h.substr(c+a.name.length)+"}"):(u=h.replace(/^\s*/,"").split(/\s+/),a.setCondition(u[1],"#ifdef"===l?1:2),a.text="//"+a.text),a.setParent(t),t=a,s)for(u=h.substr(m).split(x._splitToWordExps3),m=0;m<u.length;m++)(h=u[m]).length&&(s[h]=!0);continue;case"#if":if(a.src=h,a.noCompile=!0,a.setParent(t),t=a,s)for(u=h.substr(m).split(x._splitToWordExps3),m=0;m<u.length;m++)(h=u[m]).length&&"defined"!=h&&(s[h]=!0);continue;case"#else":a.src=h,n=(t=t.parent).childs[t.childs.length-1],a.noCompile=n.noCompile,a.noCompile||(a.condition=n.condition,a.conditionType=1==n.conditionType?2:1,a.text="//"+a.text+" "+n.text+" "+a.conditionType),a.setParent(t),t=a;continue;case"#endif":n=(t=t.parent).childs[t.childs.length-1],a.noCompile=n.noCompile,a.noCompile||(a.text="//"+a.text),a.setParent(t);continue;case"#include":u=x.splitToWords(h,null);var g=x.includes[u[1]];if(!g)throw"ShaderCompile error no this include file:"+u[1];if((c=u[0].indexOf("?"))<0){a.setParent(t),h=g.getWith("with"==u[2]?u[3]:null),this._compileToTree(a,h.split("\n"),0,r,s),a.text="";continue}a.setCondition(u[0].substr(c+1),1),a.text=g.getWith("with"==u[2]?u[3]:null);break;case"#import":o=(u=x.splitToWords(h,null))[1],r.push({node:a,file:x.includes[o],ofs:a.text.length});continue}}else{if((n=t.childs[t.childs.length-1])&&!n.name){0<r.length&&x.splitToWords(h,n),_=a,n.text+="\n"+h;continue}0<r.length&&x.splitToWords(h,a)}a.setParent(t)}},t.createShader=function(t,e,i){var r={},s="";if(t)for(var a in t)s+="#define "+a+"\n",r[a]=!0;var n=this._VS.toscript(r,[]),h=this._PS.toscript(r,[]);return(i||Qt.create)(s+n.join("\n"),s+h.join("\n"),e,this._nameMap)},x._parseOne=function(t,e,i,r,s,a){var n={type:x.shaderParamsMap[i[r+1]],name:i[r+2],size:isNaN(parseInt(i[r+3]))?1:parseInt(i[r+3])};return a&&("attribute"==s?t.push(n):e.push(n)),":"==i[r+3]&&(n.type=i[r+4],r+=2),r+=2},x.addInclude=function(t,e){if(!e||0===e.length)throw new Error("add shader include file err:"+t);if(x.includes[t])throw new Error("add shader include file err, has add:"+t);x.includes[t]=new i(e)},x.preGetParams=function(t,e){var i=[t,e],r={},s=[],a=[],n={},h=[];r.attributes=s,r.uniforms=a,r.defines=n;for(var l=0,o=0,u=0;u<2;u++){i[u]=i[u].replace(x._removeAnnotation,"");var _,c=i[u].match(x._reg);for(l=0,o=c.length;l<o;l++){var f=c[l];if("attribute"==f||"uniform"==f)l=x._parseOne(s,a,c,l,f,!0);else{if("#define"==f){h[f=c[++l]]=1;continue}if("#ifdef"==f){n[_=c[++l]]=n[_]||[];for(l++;l<o;l++)if("attribute"==(f=c[l])||"uniform"==f)l=x._parseOne(s,a,c,l,f,h[_]);else if("#else"==f)for(l++;l<o;l++)if("attribute"==(f=c[l])||"uniform"==f)l=x._parseOne(s,a,c,l,f,!h[_]);else if("#endif"==f)break}}}}return r},x.splitToWords=function(t,e){for(var i,r,s=[],a=-1,n=0,h=t.length;n<h;n++)if(i=t.charAt(n),0<=" \t=+-*/&%!<>()'\",;".indexOf(i)){if(0<=a&&1<n-a&&(r=t.substr(a,n-a),s.push(r)),'"'==i||"'"==i){var l=t.indexOf(i,n+1);if(l<0)throw"Sharder err:"+t;s.push(t.substr(n+1,l-n-1)),n=l,a=-1;continue}"("==i&&e&&0<s.length&&(r=s[s.length-1]+";","vec4;main;".indexOf(r)<0&&(e.useFuns+=r)),a=-1}else a<0&&(a=n);return a<h&&1<h-a&&(r=t.substr(a,h-a),s.push(r)),s},x.IFDEF_NO=0,x.IFDEF_YES=1,x.IFDEF_ELSE=2,x.IFDEF_PARENT=3,x._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),x._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),x._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),x.includes={},n(x,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),x.__init$=function(){v=function(){function i(t){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=t}c(i,"");var t=i.prototype;return t.setParent=function(t){t.childs.push(this),this.z=t.z+1,this.parent=t},t.setCondition=function(t,e){t&&(this.conditionType=e,t=t.replace(/(\s*$)/g,""),this.condition=function(){return this[t]},this.condition.__condition=t)},t.toscript=function(t,e){return this._toscript(t,e,++i.__id)},t._toscript=function(r,s,a){if(this.childs.length<1&&!this.text)return s;s.length;if(this.condition){var t=!!this.condition.call(r);if(2===this.conditionType&&(t=!t),!t)return s}if(this.text&&s.push(this.text),0<this.childs.length&&this.childs.forEach(function(t,e,i){t._toscript(r,s,a)}),0<this.includefiles.length&&0<this.useFuns.length)for(var e,i=0,n=this.includefiles.length;i<n;i++)this.includefiles[i].curUseID!=a&&0<(e=this.includefiles[i].file.getFunsScript(this.useFuns)).length&&(this.includefiles[i].curUseID=a,s[0]=e+s[0]);return s},i.__id=1,i}(),i=function(){function t(t){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=t;for(var e=0,i=0,r=0;!((e=t.indexOf("#begin",e))<0);){for(r=e+5;!((r=t.indexOf("#end",r))<0)&&"i"===t.charAt(r+4);)r+=5;if(r<0)throw"add include err,no #end:"+t;i=t.indexOf("\n",e);var s=x.splitToWords(t.substr(e,i-e),null);"code"==s[1]?this.codes[s[2]]=t.substr(i+1,r-i-1):"function"==s[1]&&(i=t.indexOf("function",e),i+="function".length,this.funs[s[3]]=t.substr(i+1,r-i-1),this.funnames+=s[3]+";"),e=r+1}}c(t,"");var e=t.prototype;return e.getWith=function(t){var e=t?this.codes[t]:this.script;if(!e)throw"get with error:"+t;return e},e.getFunsScript=function(t){var e="";for(var i in this.funs)0<=t.indexOf(i+";")&&(e+=this.funs[i]);return e},t}()},x}(),bt=function(){function n(){}return c(n,"laya.webgl.WebGL"),n._uint8ArraySlice=function(){for(var t=this.length,e=new Uint8Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},n._float32ArraySlice=function(){for(var t=this.length,e=new Float32Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},n._uint16ArraySlice=function(t){var e,i=arguments,r=0,s=0;if(0===i.length)for(r=this.length,e=new Uint16Array(r),s=0;s<r;s++)e[s]=this[s];else if(2===i.length){var a=i[0],n=i[1];if(a<n)for(r=n-a,e=new Uint16Array(r),s=a;s<n;s++)e[s-a]=this[s];else e=new Uint16Array(0)}return e},n.expandContext=function(){var t=s.prototype,e=CanvasRenderingContext2D.prototype;e.fillTrangles=t.fillTrangles,Zt.__int__(null),e.setIBVB=function(t,e,i,r,s,a,n,h,l,o){void 0===l&&(l=0),void 0===o&&(o=0),null===i&&(this._ib=this._ib||$t.QuadrangleIB,i=this._ib,pt.expandIBQuadrangle(i,r._byteLength/64+8)),this._setIBVB(t,e,i,r,s,a,n,h,l,o)},e.fillTrangles=function(t,e,i,r,s){this._curMat=this._curMat||S.create(),this._vb=this._vb||Jt.create(),this._ib||(this._ib=$t.create(),pt.fillIBQuadrangle(this._ib,n/4));var a=this._vb,n=r.length>>4;pt.fillTranglesVB(a,e,i,r,s||this._curMat,0,0),pt.expandIBQuadrangle(this._ib,a._byteLength/64+8);var h=new Et(1,0);h.textureHost=t;var l=new jt("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; void main() {vec4 color= texture2D(texture, v_texcoord); color.a*=1.0; gl_FragColor= color;}");a._vertType=3,this._setIBVB(e,i,this._ib,a,6*n,s,l,h,0,0)}},n.enable=function(){if(f.__init__(),g.isConchApp&&!g.isConchWebGL)return y.skinAniSprite=function(){return new tt},n.expandContext(),!1;if(y.getWebGLContext=function(t){for(var e,i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],r=0;r<i.length;r++){try{e=t.getContext(i[r],{stencil:A.isStencil,alpha:A.isAlpha,antialias:A.isAntialias,premultipliedAlpha:A.premultipliedAlpha,preserveDrawingBuffer:A.preserveDrawingBuffer})}catch(t){}if(e)return e}return null},null==(n.mainContext=y.getWebGLContext(g._mainCanvas)))return!1;if(g.isWebGL)return!0;m.create=function(t,e){return new te(t,e)},p.create=function(t,e,i,r,s,a,n){return new Kt(t,e,i,r,s,a,n)},g.WebGL=n,g.isWebGL=!0,ft.__init__(),y.createRenderSprite=function(t,e){return new St(t,e)},y.createWebGLContext2D=function(t){return new At(t)},y.changeWebGLSize=function(t,e){laya.webgl.WebGL.onStageResize(t,e)},y.createGraphics=function(){return new Tt};var t=y.createFilterAction;return y.createFilterAction=t||function(t){return new wt},y.clear=function(t){vt.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var e=g.context.ctx,i=0==e._submits._length||A.preserveDrawingBuffer?d.create(t)._color:M._wgColor;i&&e.clearBG(i[0],i[1],i[2],i[3]),vt.clear()},y.addToAtlas=function(t,e){void 0===e&&(e=!1);var i=t.bitmap;g.optimizeTextureMemory(t.url,t)?T.__typeof(i,"laya.webgl.resource.IMergeAtlasBitmap")&&i.allowMerageInAtlas&&i.on("recovered",t,t.addTextureToAtlas):i.enableMerageInAtlas=!1},y.isAtlas=function(t){return t instanceof laya.webgl.atlas.AtlasWebGLCanvas},k._enable(),y.beginFlush=function(){for(var t=k.instance,e=t.getAtlaserCount(),i=0;i<e;i++){var r=t.getAtlaserByIndex(i).texture;r._flashCacheImageNeedFlush&&y.flashFlushImage(r)}},y.drawToCanvas=function(t,e,i,r,s,a){(i<=0||r<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),i|=0,r|=0,s|=0,a|=0;var n=Nt.create(i,r,6408,5121,0,!1);n.start(),n.clear(0,0,0,0),g.context.clear(),v.renders[e]._fun(t,g.context,s,vt.height-r+a),g.context.flush(),n.end();var h=n.getData(0,0,i,r);if(n.recycle(),h.byteLength==i*r*4){var l=new Wt;l._canvas=f.createElement("canvas"),l.size(i,r);var o=l._canvas.getContext("2d");f.canvas.size(i,r);var u=f.context,_=u.createImageData(i,r);return _.data.set(new Uint8ClampedArray(h.buffer)),l._imgData=_,u.putImageData(_,0,0),o.save(),o.translate(0,r),o.scale(1,-1),o.drawImage(f.canvas.source,0,0),o.restore(),l}console.log("drawToCanvas error: w:"+i+",h:"+r+",datalen:"+h.byteLength)},y.createFilterAction=function(t){var e;switch(t){case 32:e=new wt}return e},y.addTextureToAtlas=function(t){t._uvID++,k._atlasRestore++,t.bitmap.enableMerageInAtlas&&k.instance.addToAtlas(t)},y.getTexturePixels=function(t,e,i,r,s){g.context.ctx.clear();var a=new I;a.graphics.drawTexture(t,-e,-i);var n=Nt.create(r,s);n.start(),n.clear(0,0,0,0),a.render(g.context,0,0),g.context.ctx.flush(),n.end();for(var h=n.getData(0,0,r,s),l=[],o=0,u=s-1;0<=u;u--)for(var _=0;_<r;_++)o=4*(u*r+_),l.push(h[o]),l.push(h[o+1]),l.push(h[o+2]),l.push(h[o+3]);return l},y.skinAniSprite=function(){return new tt},_.create=function(t,e){var i=new Wt;return i._imgData=e,i.flipY=!1,i},E._filterStart=function(t,e,i,r,s){var a=t.getValue("bounds"),n=Nt.create(a.width,a.height);if(n.start(),n.clear(0,0,0,0),t.addValue("src",n),t.addValue("ScissorTest",vt.worldScissorTest),vt.worldScissorTest){var h=new R;h.copyFrom(i.ctx._clipRect),t.addValue("clipRect",h),vt.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},E._filterEnd=function(t,e,i,r,s){var a=t.getValue("bounds");t.getValue("src").end();var n=Nt.create(a.width,a.height);n.start(),n.clear(0,0,0,0),t.addValue("out",n),e._set$P("_filterCache",n),e._set$P("_isHaveGlowFilter",t.getValue("_isHaveGlowFilter"))},E._EndTarget=function(t,e){if(t.getValue("src").recycle(),t.getValue("out").end(),t.getValue("ScissorTest")){vt.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),e.ctx.save();var i=t.getValue("clipRect");e.ctx.clipRect(i.x,i.y,i.width,i.height)}},E._useSrc=function(t){var e=t.getValue("out");e.end(),(e=t.getValue("src")).start(),e.clear(0,0,0,0)},E._endSrc=function(t){t.getValue("src").end()},E._useOut=function(t){var e=t.getValue("src");e.end(),(e=t.getValue("out")).start(),e.clear(0,0,0,0)},E._endOut=function(t){t.getValue("out").end()},E._recycleScope=function(t){t.recycle()},E._filter=function(t,e,i,r){var s=this._next;if(s){var a,n,h=t.filters,l=h.length;if(1==l&&32==h[0].type)return e.ctx.save(),e.ctx.setFilters([h[0]]),s._fun.call(s,t,e,i,r),void e.ctx.restore();var o=ht.create(),u=w.TEMP,_=e.ctx._getTransformMatrix(),c=S.create();_.copyTo(c);var f=0,d=0,m=!1,p=t._$P._filterCache?t._$P._filterCache:null;if(!p||t._repaint){m=t._isHaveGlowFilter(),o.addValue("_isHaveGlowFilter",m),m&&(f=50,d=25),(n=new R).copyFrom(t.getSelfBounds()),n.x+=t.x,n.y+=t.y,n.x-=t.pivotX+4,n.y-=t.pivotY+4;var g=n.x,v=n.y;if(n.width+=f+8,n.height+=f+8,u.x=n.x*c.a+n.y*c.c,u.y=n.y*c.d+n.x*c.b,n.x=u.x,n.y=u.y,u.x=n.width*c.a+n.height*c.c,u.y=n.height*c.d+n.width*c.b,n.width=u.x,n.height=u.y,n.width<=0||n.height<=0)return;p&&p.recycle(),o.addValue("bounds",n);var x=nt.create([o,t,e,0,0],E._filterStart);e.addRenderObject(x),e.ctx._renderKey=0,e.ctx._shader2D.glTexture=null;var b=t.x-g+d,y=t.y-v+d;s._fun.call(s,t,e,b,y),x=nt.create([o,t,e,0,0],E._filterEnd),e.addRenderObject(x);for(var T=0;T<l;T++){0!=T&&(x=nt.create([o],E._useSrc),e.addRenderObject(x),a=Et.create(1,0),S.TEMP.identity(),e.ctx.drawTarget(o,0,0,n.width,n.height,S.TEMP,"out",a,null,G.TOINT.overlay),x=nt.create([o],E._useOut),e.addRenderObject(x)),h[T].action.apply3d(o,t,e,0,0)}x=nt.create([o,e],E._EndTarget),e.addRenderObject(x)}else{if((m=!!t._$P._isHaveGlowFilter&&t._$P._isHaveGlowFilter)&&(f=50,d=25),(n=t.getBounds()).width<=0||n.height<=0)return;n.width+=f,n.height+=f,u.x=n.x*c.a+n.y*c.c,u.y=n.y*c.d+n.x*c.b,n.x=u.x,n.y=u.y,u.x=n.width*c.a+n.height*c.c,u.y=n.height*c.d+n.width*c.b,n.width=u.x,n.height=u.y,o.addValue("out",p)}i=i-d-t.x,r=r-d-t.y,u.setTo(i,r),c.transformPoint(u),i=u.x+n.x,r=u.y+n.y,a=Et.create(1,0),S.TEMP.identity(),e.ctx.drawTarget(o,i,r,n.width,n.height,S.TEMP,"out",a,null,G.TOINT.overlay),x=nt.create([o],E._recycleScope),e.addRenderObject(x),c.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=n._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=n._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=n._uint8ArraySlice),!0},n.onStageResize=function(t,e){null!=n.mainContext&&(n.mainContext.viewport(0,0,t,e),vt.width=t,vt.height=e)},n.onInvalidGLRes=function(){k.instance.freeAll(),b.releaseContentManagers(!0),n.doNodeRepaint(T.stage),n.mainContext.viewport(0,0,vt.width,vt.height),T.stage.event("devicelost")},n.doNodeRepaint=function(t){0==t.numChildren&&t.repaint();for(var e=0;e<t.numChildren;e++)n.doNodeRepaint(t.getChildAt(e))},n.init=function(t,e,i){n.mainCanvas=t,_._createContext=function(t){return new At(t)},Wt._createContext=function(t){return new At(t)};var r=laya.webgl.WebGL.mainContext;if(null!=r.getShaderPrecisionFormat){var s=r.getShaderPrecisionFormat(35633,36338),a=r.getShaderPrecisionFormat(35632,36338);n.shaderHighPrecision=!(!s.precision||!a.precision)}else n.shaderHighPrecision=!1;if(n.compressAstc=r.getExtension("WEBGL_compressed_texture_astc"),n.compressAtc=r.getExtension("WEBGL_compressed_texture_atc"),n.compressEtc=r.getExtension("WEBGL_compressed_texture_etc"),n.compressEtc1=r.getExtension("WEBGL_compressed_texture_etc1"),n.compressPvrtc=r.getExtension("WEBGL_compressed_texture_pvrtc"),n.compressS3tc=r.getExtension("WEBGL_compressed_texture_s3tc"),n.compressS3tc_srgb=r.getExtension("WEBGL_compressed_texture_s3tc_srgb"),r.deleteTexture1=r.deleteTexture,r.deleteTexture=function(t){t==yt.curBindTexValue&&(yt.curBindTexValue=null),r.deleteTexture1(t)},n.onStageResize(e,i),null==n.mainContext)throw new Error("webGL getContext err!");P.__init__(),k.__init__(),It.__init__(),at.__init__(),At.__init__(),Et.__init__(),$.__init__(),Zt.__int__(r),G._init_(r),g.isConchApp&&conch.setOnInvalidGLRes(n.onInvalidGLRes)},n.compressAstc=null,n.compressAtc=null,n.compressEtc=null,n.compressEtc1=null,n.compressPvrtc=null,n.compressS3tc=null,n.compressS3tc_srgb=null,n.mainCanvas=null,n.mainContext=null,n.antialias=!0,n.shaderHighPrecision=!1,n._bg_null=[0,0,0,0],n}(),yt=function(){function r(){}return c(r,"laya.webgl.WebGLContext"),r.UseProgram=function(t){return r._useProgram!==t&&(bt.mainContext.useProgram(t),r._useProgram=t,!0)},r.setDepthTest=function(t,e){e!==r._depthTest&&((r._depthTest=e)?t.enable(2929):t.disable(2929))},r.setDepthMask=function(t,e){e!==r._depthMask&&(r._depthMask=e,t.depthMask(e))},r.setDepthFunc=function(t,e){e!==r._depthFunc&&(r._depthFunc=e,t.depthFunc(e))},r.setBlend=function(t,e){e!==r._blend&&((r._blend=e)?t.enable(3042):t.disable(3042))},r.setBlendFunc=function(t,e,i){(e!==r._sFactor||i!==r._dFactor)&&(r._sFactor=e,r._dFactor=i,t.blendFunc(e,i))},r.setCullFace=function(t,e){e!==r._cullFace&&((r._cullFace=e)?t.enable(2884):t.disable(2884))},r.setFrontFace=function(t,e){e!==r._frontFace&&(r._frontFace=e,t.frontFace(e))},r.bindTexture=function(t,e,i){t.bindTexture(e,i),r.curBindTexTarget=e,r.curBindTexValue=i},r.DEPTH_BUFFER_BIT=256,r.STENCIL_BUFFER_BIT=1024,r.COLOR_BUFFER_BIT=16384,r.POINTS=0,r.LINES=1,r.LINE_LOOP=2,r.LINE_STRIP=3,r.TRIANGLES=4,r.TRIANGLE_STRIP=5,r.TRIANGLE_FAN=6,r.ZERO=0,r.ONE=1,r.SRC_COLOR=768,r.ONE_MINUS_SRC_COLOR=769,r.SRC_ALPHA=770,r.ONE_MINUS_SRC_ALPHA=771,r.DST_ALPHA=772,r.ONE_MINUS_DST_ALPHA=773,r.DST_COLOR=774,r.ONE_MINUS_DST_COLOR=775,r.SRC_ALPHA_SATURATE=776,r.FUNC_ADD=32774,r.BLEND_EQUATION=32777,r.BLEND_EQUATION_RGB=32777,r.BLEND_EQUATION_ALPHA=34877,r.FUNC_SUBTRACT=32778,r.FUNC_REVERSE_SUBTRACT=32779,r.BLEND_DST_RGB=32968,r.BLEND_SRC_RGB=32969,r.BLEND_DST_ALPHA=32970,r.BLEND_SRC_ALPHA=32971,r.CONSTANT_COLOR=32769,r.ONE_MINUS_CONSTANT_COLOR=32770,r.CONSTANT_ALPHA=32771,r.ONE_MINUS_CONSTANT_ALPHA=32772,r.BLEND_COLOR=32773,r.ARRAY_BUFFER=34962,r.ELEMENT_ARRAY_BUFFER=34963,r.ARRAY_BUFFER_BINDING=34964,r.ELEMENT_ARRAY_BUFFER_BINDING=34965,r.STREAM_DRAW=35040,r.STATIC_DRAW=35044,r.DYNAMIC_DRAW=35048,r.BUFFER_SIZE=34660,r.BUFFER_USAGE=34661,r.CURRENT_VERTEX_ATTRIB=34342,r.FRONT=1028,r.BACK=1029,r.CULL_FACE=2884,r.FRONT_AND_BACK=1032,r.BLEND=3042,r.DITHER=3024,r.STENCIL_TEST=2960,r.DEPTH_TEST=2929,r.SCISSOR_TEST=3089,r.POLYGON_OFFSET_FILL=32823,r.SAMPLE_ALPHA_TO_COVERAGE=32926,r.SAMPLE_COVERAGE=32928,r.NO_ERROR=0,r.INVALID_ENUM=1280,r.INVALID_VALUE=1281,r.INVALID_OPERATION=1282,r.OUT_OF_MEMORY=1285,r.CW=2304,r.CCW=2305,r.LINE_WIDTH=2849,r.ALIASED_POINT_SIZE_RANGE=33901,r.ALIASED_LINE_WIDTH_RANGE=33902,r.CULL_FACE_MODE=2885,r.FRONT_FACE=2886,r.DEPTH_RANGE=2928,r.DEPTH_WRITEMASK=2930,r.DEPTH_CLEAR_VALUE=2931,r.DEPTH_FUNC=2932,r.STENCIL_CLEAR_VALUE=2961,r.STENCIL_FUNC=2962,r.STENCIL_FAIL=2964,r.STENCIL_PASS_DEPTH_FAIL=2965,r.STENCIL_PASS_DEPTH_PASS=2966,r.STENCIL_REF=2967,r.STENCIL_VALUE_MASK=2963,r.STENCIL_WRITEMASK=2968,r.STENCIL_BACK_FUNC=34816,r.STENCIL_BACK_FAIL=34817,r.STENCIL_BACK_PASS_DEPTH_FAIL=34818,r.STENCIL_BACK_PASS_DEPTH_PASS=34819,r.STENCIL_BACK_REF=36003,r.STENCIL_BACK_VALUE_MASK=36004,r.STENCIL_BACK_WRITEMASK=36005,r.VIEWPORT=2978,r.SCISSOR_BOX=3088,r.COLOR_CLEAR_VALUE=3106,r.COLOR_WRITEMASK=3107,r.UNPACK_ALIGNMENT=3317,r.PACK_ALIGNMENT=3333,r.MAX_TEXTURE_SIZE=3379,r.MAX_VIEWPORT_DIMS=3386,r.SUBPIXEL_BITS=3408,r.RED_BITS=3410,r.GREEN_BITS=3411,r.BLUE_BITS=3412,r.ALPHA_BITS=3413,r.DEPTH_BITS=3414,r.STENCIL_BITS=3415,r.POLYGON_OFFSET_UNITS=10752,r.POLYGON_OFFSET_FACTOR=32824,r.TEXTURE_BINDING_2D=32873,r.SAMPLE_BUFFERS=32936,r.SAMPLES=32937,r.SAMPLE_COVERAGE_VALUE=32938,r.SAMPLE_COVERAGE_INVERT=32939,r.NUM_COMPRESSED_TEXTURE_FORMATS=34466,r.COMPRESSED_TEXTURE_FORMATS=34467,r.DONT_CARE=4352,r.FASTEST=4353,r.NICEST=4354,r.GENERATE_MIPMAP_HINT=33170,r.BYTE=5120,r.UNSIGNED_BYTE=5121,r.SHORT=5122,r.UNSIGNED_SHORT=5123,r.INT=5124,r.UNSIGNED_INT=5125,r.FLOAT=5126,r.DEPTH_COMPONENT=6402,r.ALPHA=6406,r.RGB=6407,r.RGBA=6408,r.LUMINANCE=6409,r.LUMINANCE_ALPHA=6410,r.UNSIGNED_SHORT_4_4_4_4=32819,r.UNSIGNED_SHORT_5_5_5_1=32820,r.UNSIGNED_SHORT_5_6_5=33635,r.FRAGMENT_SHADER=35632,r.VERTEX_SHADER=35633,r.MAX_VERTEX_ATTRIBS=34921,r.MAX_VERTEX_UNIFORM_VECTORS=36347,r.MAX_VARYING_VECTORS=36348,r.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,r.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,r.MAX_TEXTURE_IMAGE_UNITS=34930,r.MAX_FRAGMENT_UNIFORM_VECTORS=36349,r.SHADER_TYPE=35663,r.DELETE_STATUS=35712,r.LINK_STATUS=35714,r.VALIDATE_STATUS=35715,r.ATTACHED_SHADERS=35717,r.ACTIVE_UNIFORMS=35718,r.ACTIVE_ATTRIBUTES=35721,r.SHADING_LANGUAGE_VERSION=35724,r.CURRENT_PROGRAM=35725,r.NEVER=512,r.LESS=513,r.EQUAL=514,r.LEQUAL=515,r.GREATER=516,r.NOTEQUAL=517,r.GEQUAL=518,r.ALWAYS=519,r.KEEP=7680,r.REPLACE=7681,r.INCR=7682,r.DECR=7683,r.INVERT=5386,r.INCR_WRAP=34055,r.DECR_WRAP=34056,r.VENDOR=7936,r.RENDERER=7937,r.VERSION=7938,r.NEAREST=9728,r.LINEAR=9729,r.NEAREST_MIPMAP_NEAREST=9984,r.LINEAR_MIPMAP_NEAREST=9985,r.NEAREST_MIPMAP_LINEAR=9986,r.LINEAR_MIPMAP_LINEAR=9987,r.TEXTURE_MAG_FILTER=10240,r.TEXTURE_MIN_FILTER=10241,r.TEXTURE_WRAP_S=10242,r.TEXTURE_WRAP_T=10243,r.TEXTURE_2D=3553,r.TEXTURE=5890,r.TEXTURE_CUBE_MAP=34067,r.TEXTURE_BINDING_CUBE_MAP=34068,r.TEXTURE_CUBE_MAP_POSITIVE_X=34069,r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,r.MAX_CUBE_MAP_TEXTURE_SIZE=34076,r.TEXTURE0=33984,r.TEXTURE1=33985,r.TEXTURE2=33986,r.TEXTURE3=33987,r.TEXTURE4=33988,r.TEXTURE5=33989,r.TEXTURE6=33990,r.TEXTURE7=33991,r.TEXTURE8=33992,r.TEXTURE9=33993,r.TEXTURE10=33994,r.TEXTURE11=33995,r.TEXTURE12=33996,r.TEXTURE13=33997,r.TEXTURE14=33998,r.TEXTURE15=33999,r.TEXTURE16=34e3,r.TEXTURE17=34001,r.TEXTURE18=34002,r.TEXTURE19=34003,r.TEXTURE20=34004,r.TEXTURE21=34005,r.TEXTURE22=34006,r.TEXTURE23=34007,r.TEXTURE24=34008,r.TEXTURE25=34009,r.TEXTURE26=34010,r.TEXTURE27=34011,r.TEXTURE28=34012,r.TEXTURE29=34013,r.TEXTURE30=34014,r.TEXTURE31=34015,r.ACTIVE_TEXTURE=34016,r.REPEAT=10497,r.CLAMP_TO_EDGE=33071,r.MIRRORED_REPEAT=33648,r.FLOAT_VEC2=35664,r.FLOAT_VEC3=35665,r.FLOAT_VEC4=35666,r.INT_VEC2=35667,r.INT_VEC3=35668,r.INT_VEC4=35669,r.BOOL=35670,r.BOOL_VEC2=35671,r.BOOL_VEC3=35672,r.BOOL_VEC4=35673,r.FLOAT_MAT2=35674,r.FLOAT_MAT3=35675,r.FLOAT_MAT4=35676,r.SAMPLER_2D=35678,r.SAMPLER_CUBE=35680,r.VERTEX_ATTRIB_ARRAY_ENABLED=34338,r.VERTEX_ATTRIB_ARRAY_SIZE=34339,r.VERTEX_ATTRIB_ARRAY_STRIDE=34340,r.VERTEX_ATTRIB_ARRAY_TYPE=34341,r.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,r.VERTEX_ATTRIB_ARRAY_POINTER=34373,r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,r.COMPILE_STATUS=35713,r.LOW_FLOAT=36336,r.MEDIUM_FLOAT=36337,r.HIGH_FLOAT=36338,r.LOW_INT=36339,r.MEDIUM_INT=36340,r.HIGH_INT=36341,r.FRAMEBUFFER=36160,r.RENDERBUFFER=36161,r.RGBA4=32854,r.RGB5_A1=32855,r.RGB565=36194,r.DEPTH_COMPONENT16=33189,r.STENCIL_INDEX=6401,r.STENCIL_INDEX8=36168,r.DEPTH_STENCIL=34041,r.RENDERBUFFER_WIDTH=36162,r.RENDERBUFFER_HEIGHT=36163,r.RENDERBUFFER_INTERNAL_FORMAT=36164,r.RENDERBUFFER_RED_SIZE=36176,r.RENDERBUFFER_GREEN_SIZE=36177,r.RENDERBUFFER_BLUE_SIZE=36178,r.RENDERBUFFER_ALPHA_SIZE=36179,r.RENDERBUFFER_DEPTH_SIZE=36180,r.RENDERBUFFER_STENCIL_SIZE=36181,r.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,r.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,r.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,r.COLOR_ATTACHMENT0=36064,r.DEPTH_ATTACHMENT=36096,r.STENCIL_ATTACHMENT=36128,r.DEPTH_STENCIL_ATTACHMENT=33306,r.NONE=0,r.FRAMEBUFFER_COMPLETE=36053,r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,r.FRAMEBUFFER_UNSUPPORTED=36061,r.FRAMEBUFFER_BINDING=36006,r.RENDERBUFFER_BINDING=36007,r.MAX_RENDERBUFFER_SIZE=34024,r.INVALID_FRAMEBUFFER_OPERATION=1286,r.UNPACK_FLIP_Y_WEBGL=37440,r.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,r.CONTEXT_LOST_WEBGL=37442,r.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,r.BROWSER_DEFAULT_WEBGL=37444,r._useProgram=null,r._depthTest=!0,r._depthMask=!0,r._blend=!1,r._cullFace=!1,r.curBindTexTarget=null,r.curBindTexValue=null,n(r,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),r}(),Tt=function(t){function e(){e.__super.call(this)}c(e,"laya.webgl.display.GraphicsGL",o);var i=e.prototype;return i.setShader=function(t){this._saveToCmd(g.context._setShader,[t])},i.setIBVB=function(t,e,i,r,s,a){this._saveToCmd(g.context._setIBVB,[t,e,i,r,s,a])},i.drawParticle=function(t,e,i){var r=y.createParticleTemplate2D(i);r.x=t,r.y=e,this._saveToCmd(g.context._drawParticle,[r])},e}(),At=function(t){var i;function U(t){this._x=0,this._y=0,this._id=++U._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,U.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=U.MAXCLIPRECT,this.mOutPoint,this._canvas=t,U._contextcount++,g.isFlash?(this._ib=$t.create(35044),pt.fillIBQuadrangle(this._ib,16)):this._ib=$t.QuadrangleIB,this.clear()}c(U,"laya.webgl.canvas.WebGLContext2D",s);var e=U.prototype;return e.setIsMainContext=function(){this._isMain=!0},e.clearBG=function(t,e,i,r){var s=bt.mainContext;s.clearColor(t,e,i,r),s.clear(16384)},e._getSubmits=function(){return this._submits},e._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},e.destroy=function(){--U._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas=null,this._ib&&this._ib!=$t.QuadrangleIB&&this._ib.releaseResource()},e.clear=function(){this._submits||(this._other=i.DEFAULT,this._curMat=S.create(),this._vb=Jt.create(-1),this._submits=[],this._save=[Q.Create(this)],this._save.length=10,this._shader2D=new $,this._triangleMesh=Ft.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=i.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=U.MAXCLIPRECT,this._curSubmit=at.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=z.DEFAULT;for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},e.size=function(t,e){if(this._width!=t||this._height!=e)if(0==t||0==e){0!=this._vb._byteLength&&(this._width=t,this._height=e,this._vb.clear(),this._vb.upload());for(var i=0,r=this._submits._length;i<r;i++)this._submits[i].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=t,this._height=e,this._targets&&this._targets.size(t,e),this._canvas.memorySize-=this._canvas.memorySize;0===t&&0===e&&this._releaseMem()},e._getTransformMatrix=function(){return this._curMat},e.translate=function(t,e){0===t&&0===e||(q.save(this),this._curMat.bTransform&&(Z.save(this),this._curMat.transformPointN(w.TEMP.setTo(t,e)),t=w.TEMP.x,e=w.TEMP.y),this._x+=t,this._y+=e)},e.save=function(){this._save[this._save._length++]=Q.Create(this)},e.restore=function(){var t=this._save._length;if(!(t<1))for(var e=t-1;0<=e;e--){var i=this._save[e];if(i.restore(this),i.isSaveMark())return void(this._save._length=e)}},e._fillText=function(t,e,i,r,s,a,n,h,l,o){void 0===o&&(o=0);var u=this._shader2D,_=this._curSubmit.shaderValue,c=s?dt.create(s):this._other.font;if(k.enabled)u.ALPHA!==_.ALPHA&&(u.glTexture=null),ft.drawText(this,t,e,this._curMat,c,l||this._other.textAlign,a,n,h,i,r,o);else{this._shader2D.defines.getValue();var f=a?d.create(a)._color:u.colorAdd;u.ALPHA===_.ALPHA&&f===u.colorAdd&&_.colorAdd===u.colorAdd||(u.glTexture=null,u.colorAdd=f),ft.drawText(this,t,e,this._curMat,c,l||this._other.textAlign,a,n,h,i,r,o)}},e.fillWords=function(t,e,i,r,s,a){this._fillText(null,t,e,i,r,s,null,-1,null,a)},e.fillBorderWords=function(t,e,i,r,s,a,n){this._fillBorderText(null,t,e,i,r,s,a,n,null)},e.fillText=function(t,e,i,r,s,a){this._fillText(t,null,e,i,r,s,null,-1,a)},e.strokeText=function(t,e,i,r,s,a,n){this._fillText(t,null,e,i,r,null,s,a||1,n)},e.fillBorderText=function(t,e,i,r,s,a,n,h){this._fillBorderText(t,null,e,i,r,s,a,n,h)},e._fillBorderText=function(t,e,i,r,s,a,n,h,l){if(!k.enabled)return this._fillText(t,e,i,r,s,null,n,h||1,l),void this._fillText(t,e,i,r,s,a,null,-1,l);var o=this._shader2D,u=this._curSubmit.shaderValue;o.ALPHA!==u.ALPHA&&(o.glTexture=null);var _=s?(U._fontTemp.setFont(s),U._fontTemp):this._other.font;ft.drawText(this,t,e,this._curMat,_,l||this._other.textAlign,a,n,h||1,i,r,0)},e.fillRect=function(t,e,i,r,s){var a=this._vb;if(pt.fillRectImgVb(a,this._clipRect,t,e,i,r,F.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var n=this._shader2D.fillStyle;s&&(this._shader2D.fillStyle=z.create(s));var h=this._shader2D,l=this._curSubmit.shaderValue;if(h.fillStyle!==l.fillStyle||h.ALPHA!==l.ALPHA){h.glTexture=null;var o=this._curSubmit=at.createSubmit(this,this._ib,a,(a._byteLength-64)/32*3,Et.create(2,0));o.shaderValue.color=h.fillStyle._color._color,o.shaderValue.ALPHA=h.ALPHA,this._submits[this._submits._length++]=o}this._curSubmit._numEle+=6,this._shader2D.fillStyle=n}},e.fillTexture=function(t,e,i,r,s,a,n,h){if(t.loaded&&t.bitmap&&t.source){var l=this._vb,o=t.bitmap.width,u=t.bitmap.height,_=t.uv,c=n.x%t.width,f=n.y%t.height;if(o!=h.w||u!=h.h){if(!h.w&&!h.h)switch(h.oy=h.ox=0,a){case"repeat":h.width=r,h.height=s;break;case"repeat-x":h.width=r,f<0?t.height+f>s?h.height=s:h.height=t.height+f:(h.oy=f,t.height+f>s?h.height=s-f:h.height=t.height);break;case"repeat-y":c<0?t.width+c>r?h.width=r:h.width=t.width+c:(h.ox=c,t.width+c>r?h.width=r-c:h.width=t.width),h.height=s;break;case"no-repeat":c<0?t.width+c>r?h.width=r:h.width=t.width+c:(h.ox=c,t.width+c>r?h.width=r-c:h.width=t.width),f<0?t.height+f>s?h.height=s:h.height=t.height+f:(h.oy=f,t.height+f>s?h.height=s-f:h.height=t.height);break;default:h.width=r,h.height=s}h.w=o,h.h=u,h.uv=[0,0,h.width/o,0,h.width/o,h.height/u,0,h.height/u]}if(e+=h.ox,i+=h.oy,c-=h.ox,f-=h.oy,pt.fillRectImgVb(l,this._clipRect,e,i,h.width,h.height,h.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var d=Dt.create(this,this._ib,l,(l._byteLength-64)/32*3,Et.create(256,0)),m=(this._submits[this._submits._length++]=d).shaderValue;m.textureHost=t;var p=_[0]*o,g=_[1]*u,v=(_[2]-_[0])*o,x=(_[5]-_[3])*u,b=-c/o,y=-f/u;m.u_TexRange[0]=p/o,m.u_TexRange[1]=v/o,m.u_TexRange[2]=g/u,m.u_TexRange[3]=x/u,m.u_offset[0]=b,m.u_offset[1]=y,k.enabled&&!this._isMain&&d.addTexture(t,(l._byteLength>>2)-16),(this._curSubmit=d)._renderType=10017,d._numEle+=6}}else this.sprite&&T.timer.callLater(this,this._repaintSprite)},e.setShader=function(t){Y.save(this,1048576,this._shader2D,!0),this._shader2D.shader=t},e.setFilters=function(t){Y.save(this,2097152,this._shader2D,!0),this._shader2D.filters=t,this._curSubmit=at.RENDERBASE,this._renderKey=0,this._drawCount++},e.drawTexture=function(t,e,i,r,s,a,n){this._drawTextureM(t,e,i,r,s,a,n,null,1)},e.addTextureVb=function(t,e,i){var r=this._curSubmit._vb||this._vb,s=r._byteLength>>2;r.byteLength=s+16<<2;for(var a=r.getFloat32Array(),n=0;n<16;n+=4)a[s++]=t[n]+e,a[s++]=t[n+1]+i,a[s++]=t[n+2],a[s++]=t[n+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),r._upload=!0},e.willDrawTexture=function(t,e){if(!(t.loaded&&t.bitmap&&t.source))return this.sprite&&T.timer.callLater(this,this._repaintSprite),0;var i=t.bitmap,r=i.id+this._shader2D.ALPHA*e+10016;if(r==this._renderKey)return r;var s=this._shader2D,a=s.ALPHA,n=this._curSubmit.shaderValue;s.ALPHA*=e,this._renderKey=r,this._drawCount++,s.glTexture=i;var h=this._vb,l=null,o=h._byteLength/32*3;return l=Dt.create(this,this._ib,h,o,Et.create(1,0)),(this._submits[this._submits._length++]=l).shaderValue.textureHost=t,l._renderType=10016,l._preIsSameTextureShader=10016===this._curSubmit._renderType&&s.ALPHA===n.ALPHA,this._curSubmit=l,s.ALPHA=a,r},e.drawTextures=function(t,e,i,r){if(t.loaded&&t.bitmap&&t.source){var s=this._clipRect;if(this._clipRect=U.MAXCLIPRECT,this._drawTextureM(t,e[0],e[1],t.width,t.height,i,r,null,1)){if(this._clipRect=s,C.drawCall++,!(e.length<4)){for(var a=this._curSubmit._vb||this._vb,n=this._curMat.a,h=this._curMat.d,l=2,o=e.length;l<o;l+=2)pt.copyPreImgVb(a,(e[l]-e[l-2])*n,(e[l+1]-e[l-1])*h),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&T.timer.callLater(this,this._repaintSprite)},e._drawTextureM=function(t,e,i,r,s,a,n,h,l){if(!t.loaded||!t.source)return this.sprite&&T.timer.callLater(this,this._repaintSprite),!1;var o=this._curSubmit._vb||this._vb,u=t.bitmap;e+=a,i+=n,this._drawCount++;var _=u.id+this._shader2D.ALPHA*l+10016;if(_!=this._renderKey){this._renderKey=_;var c=this._curSubmit.shaderValue,f=this._shader2D,d=f.ALPHA;f.ALPHA*=l,f.glTexture=u;var m=this._vb,p=null,g=m._byteLength/32*3;p=Dt.create(this,this._ib,m,g,Et.create(1,0)),(this._submits[this._submits._length++]=p).shaderValue.textureHost=t,p._renderType=10016,p._preIsSameTextureShader=10016===this._curSubmit._renderType&&f.ALPHA===c.ALPHA,this._curSubmit=p,o=this._curSubmit._vb||this._vb,f.ALPHA=d}return!!pt.fillRectImgVb(o,this._clipRect,e,i,r||t.width,s||t.height,t.uv,h||this._curMat,this._x,this._y,0,0)&&(k.enabled&&!this._isMain&&this._curSubmit.addTexture(t,(o._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},e._repaintSprite=function(){this.sprite&&this.sprite.repaint()},e._drawText=function(t,e,i,r,s,a,n,h,l,o){var u=t.bitmap;this._drawCount++;var _=u.id+this._shader2D.ALPHA+10016;if(_!=this._renderKey){this._renderKey=_;var c=this._curSubmit.shaderValue,f=this._shader2D;f.glTexture=u;var d=this._vb,m=null,p=d._byteLength/32*3;(m=k.enabled?Dt.create(this,this._ib,d,p,Et.create(1,0)):Dt.create(this,this._ib,d,p,qt.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&f.ALPHA===c.ALPHA,(this._submits[this._submits._length++]=m).shaderValue.textureHost=t,m._renderType=10016,this._curSubmit=m}t.active();var g=this._curSubmit._vb||this._vb;pt.fillRectImgVb(g,this._clipRect,e+n,i+h,r||t.width,s||t.height,t.uv,a||this._curMat,this._x,this._y,l,o,!0)&&(k.enabled&&!this._isMain&&this._curSubmit.addTexture(t,(g._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},e.drawTextureWithTransform=function(t,e,i,r,s,a,n,h,l){if(a){var o=this._curMat,u=this._x,_=this._y;(0!==n||0!==h)&&(this._x=n*o.a+h*o.c,this._y=h*o.d+n*o.b),a&&o.bTransform?(S.mul(a,o,U._tmpMatrix),(a=U._tmpMatrix)._checkTransform()):(this._x+=o.tx,this._y+=o.ty),this._drawTextureM(t,e,i,r,s,0,0,a,l),this._x=u,this._y=_}else this._drawTextureM(t,e,i,r,s,n,h,null,l)},e.fillQuadrangle=function(t,e,i,r,s){var a=this._curSubmit,n=this._vb,h=this._shader2D,l=a.shaderValue;if(this._renderKey=0,t.bitmap){var o=t.bitmap;h.glTexture==o&&h.ALPHA===l.ALPHA||(h.glTexture=o,(a=this._curSubmit=at.createSubmit(this,this._ib,n,n._byteLength/32*3,Et.create(1,0))).shaderValue.glTexture=o,this._submits[this._submits._length++]=a),pt.fillQuadrangleImgVb(n,e,i,r,t.uv,s||this._curMat,this._x,this._y)}else a.shaderValue.fillStyle&&a.shaderValue.fillStyle.equal(t)&&h.ALPHA===l.ALPHA||(h.glTexture=null,(a=this._curSubmit=at.createSubmit(this,this._ib,n,n._byteLength/32*3,Et.create(2,0))).shaderValue.defines.add(2),a.shaderValue.fillStyle=z.create(t),this._submits[this._submits._length++]=a),pt.fillQuadrangleImgVb(n,e,i,r,F.DEF_UV,s||this._curMat,this._x,this._y);a._numEle+=6},e.drawTexture2=function(t,e,i,r,s,a,n,h){if(0!=a){var l=this._curMat;if(this._x=t*l.a+e*l.c,this._y=e*l.d+t*l.b,s&&(s=l.bTransform||s.bTransform?(S.mul(s,l,U._tmpMatrix),U._tmpMatrix):(this._x+=s.tx+l.tx,this._y+=s.ty+l.ty,S.EMPTY)),1!==a||n){var o=this._shader2D.ALPHA,u=this._nBlendType;this._shader2D.ALPHA=a,n&&(this._nBlendType=G.TOINT(n)),this._drawTextureM(h[0],h[1]-i,h[2]-r,h[3],h[4],0,0,s,1),this._shader2D.ALPHA=o,this._nBlendType=u}else this._drawTextureM(h[0],h[1]-i,h[2]-r,h[3],h[4],0,0,s,1);this._x=this._y=0}},e.drawCanvas=function(t,e,i,r,s){var a=t.context;if(this._renderKey=0,a._targets)this._submits[this._submits._length++]=Pt.create(a,0,null),this._curSubmit=at.RENDERBASE,a._targets.drawTo(this,e,i,r,s);else{var n=this._submits[this._submits._length++]=Pt.create(a,this._shader2D.ALPHA,this._shader2D.filters),h=r/t.width,l=s/t.height,o=n._matrix;this._curMat.copyTo(o),1!=h&&1!=l&&o.scale(h,l);var u=o.tx,_=o.ty;o.tx=o.ty=0,o.transformPoint(w.TEMP.setTo(e,i)),o.translate(w.TEMP.x+u,w.TEMP.y+_),this._curSubmit=at.RENDERBASE}A.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=a._targets?"yellow":"green",this.strokeRect(e-1,i-1,r+2,s+2,1),this.strokeRect(e,i,r,s,1),this.restore())},e.drawTarget=function(t,e,i,r,s,a,n,h,l,o){void 0===o&&(o=-1);var u=this._vb;if(pt.fillRectImgVb(u,this._clipRect,e,i,r,s,l||F.DEF_UV,a||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null;this._curSubmit.shaderValue;var _=this._curSubmit=_t.create(this,this._ib,u,(u._byteLength-64)/32*3,h,n);_.blendType=-1==o?this._nBlendType:o,_.scope=t,this._submits[this._submits._length++]=_,this._curSubmit._numEle+=6}},e.mixRGBandAlpha=function(t){return this._mixRGBandAlpha(t,this._shader2D.ALPHA)},e._mixRGBandAlpha=function(t,e){var i=(4278190080&t)>>>24;return 0!=i?i*=e:i=255*e,16777215&t|i<<24},e.drawTriangles=function(t,e,i,r,s,a,n,h,l,o){if(!t.loaded||!t.source)return this.sprite&&T.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;t.bitmap;var u=this._mixRGBandAlpha(4294967295,h),_=(r.length,a.length);this._renderKey=-1;var c=this._curSubmit=Dt.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,Et.create(1,0));return c.shaderValue.textureHost=t,c._renderType=10016,this._submits[this._submits._length++]=c,n?(U._tmpMatrix.a=n.a,U._tmpMatrix.b=n.b,U._tmpMatrix.c=n.c,U._tmpMatrix.d=n.d,U._tmpMatrix.tx=n.tx+e,U._tmpMatrix.ty=n.ty+i,S.mul(U._tmpMatrix,this._curMat,U._tmpMatrix)):(U._tmpMatrix.a=this._curMat.a,U._tmpMatrix.b=this._curMat.b,U._tmpMatrix.c=this._curMat.c,U._tmpMatrix.d=this._curMat.d,U._tmpMatrix.tx=this._curMat.tx+e,U._tmpMatrix.ty=this._curMat.ty+i),this._triangleMesh.addData(r,s,a,U._tmpMatrix,u,this),this._curSubmit._numEle+=_,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},e.transform=function(t,e,i,r,s,a){Z.save(this),S.mul(S.TEMP.setTo(t,e,i,r,s,a),this._curMat,this._curMat),this._curMat._checkTransform()},e.setTransformByMatrix=function(t){t.copyTo(this._curMat)},e.transformByMatrix=function(t){Z.save(this),S.mul(t,this._curMat,this._curMat),this._curMat._checkTransform()},e.rotate=function(t){Z.save(this),this._curMat.rotateEx(t)},e.scale=function(t,e){Z.save(this),this._curMat.scaleEx(t,e)},e.clipRect=function(t,e,i,r){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var s=ut.create(4);this.addRenderObject(s);var a=this._vb,n=a._byteLength>>2;if(pt.fillRectImgVb(a,null,t,e,i,r,F.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var h=this._curSubmit=at.createSubmit(this,this._ib,a,(a._byteLength-64)/32*3,Et.create(2,0));h.shaderValue.ALPHA=1,this._submits[this._submits._length++]=h,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var l=ut.create(5);this.addRenderObject(l);var o=a.getFloat32Array(),u=Math.min(Math.min(Math.min(o[n+0],o[n+4]),o[n+8]),o[n+12]),_=Math.max(Math.max(Math.max(o[n+0],o[n+4]),o[n+8]),o[n+12]),c=Math.min(Math.min(Math.min(o[n+1],o[n+5]),o[n+9]),o[n+13]),f=Math.max(Math.max(Math.max(o[n+1],o[n+5]),o[n+9]),o[n+13]);K.save(this,l,t,e,i,r,u,c,_-u,f-c),this._curSubmit=at.RENDERBASE}else{i*=this._curMat.a,r*=this._curMat.d;var d=w.TEMP;this._curMat.transformPoint(d.setTo(t,e)),i<0&&(d.x=d.x+i,i=-i),r<0&&(d.y=d.y+r,r=-r),this._renderKey=0;var m=this._curSubmit=ot.create(this);(this._submits[this._submits._length++]=m).submitIndex=this._submits._length,m.submitLength=9999999,X.save(this,m);var p=this._clipRect,g=p.x,v=p.y,x=d.x+i,b=d.y+r;g<d.x&&(p.x=d.x),v<d.y&&(p.y=d.y),p.width=Math.min(x,g+p.width)-p.x,p.height=Math.min(b,v+p.height)-p.y,this._shader2D.glTexture=null,m.clipRect.copyFrom(p),this._curSubmit=at.RENDERBASE}},e.setIBVB=function(t,e,i,r,s,a,n,h,l,o,u){if(void 0===l&&(l=0),void 0===o&&(o=0),void 0===u&&(u=0),null===i){if(g.isFlash){var _=r;_._selfIB||(_._selfIB=$t.create(35044)),_._selfIB.clear(),i=_._selfIB}else i=this._ib;pt.expandIBQuadrangle(i,r._byteLength/(4*r.vertexStride*4))}if(!h||!n)throw Error("setIBVB must input:shader shaderValues");var c=lt.create(this,r,i,s,n,h,l,o,u);a||(a=S.EMPTY),a.translate(t,e),S.mul(a,this._curMat,c._mat),a.translate(-t,-e),this._submits[this._submits._length++]=c,this._curSubmit=at.RENDERBASE,this._renderKey=0},e.addRenderObject=function(t){this._submits[this._submits._length++]=t},e.fillTrangles=function(t,e,i,r,s){var a=this._curSubmit,n=this._vb,h=this._shader2D,l=a.shaderValue,o=r.length>>4,u=t.bitmap;this._renderKey=0,h.glTexture==u&&h.ALPHA===l.ALPHA||((a=this._curSubmit=at.createSubmit(this,this._ib,n,n._byteLength/32*3,Et.create(1,0))).shaderValue.textureHost=t,this._submits[this._submits._length++]=a),pt.fillTranglesVB(n,e,i,r,s||this._curMat,this._x,this._y),a._numEle+=6*o},e.submitElement=function(t,e){var i=this._submits;for(e<0&&(e=i._length);t<e;)t+=i[t].renderSubmit()},e.finish=function(){bt.mainContext.finish()},e.flush=function(){var t=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if(t>this._ib.bufferLength/12&&pt.expandIBQuadrangle(this._ib,t),!this._isMain&&k.enabled&&k._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=k._atlasRestore;for(var e=this._submits,i=0,r=e._length;i<r;i++){var s=e[i];10016===s.getRenderType()&&s.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),et.instance&&et.getInstance().reset();var a;for(i=0,a=this.meshlist.length;i<a;i++){var n=this.meshlist[i];n.canReuse?n.releaseMesh():n.destroy()}return this.meshlist.length=0,this._curSubmit=at.RENDERBASE,this._renderKey=0,this._triangleMesh=Ft.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},e.setPathId=function(t){if(this.mId=t,-1!=this.mId){this.mHaveKey=!1;var e=N.getInstance();e.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,e.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},e.movePath=function(t,e){var i=t,r=e;t=this._curMat.a*i+this._curMat.c*r+this._curMat.tx,e=this._curMat.b*i+this._curMat.d*r+this._curMat.ty,this.mX+=t,this.mY+=e},e.beginPath=function(){var t=this._getPath();t.tempArray.length=0,t.closePath=!1,this.mX=0,this.mY=0},e.closePath=function(){this._path.closePath=!0},e.fill=function(t){void 0===t&&(t=!1);var e=this._getPath();this.drawPoly(0,0,e.tempArray,this.fillStyle._color.numColor,0,0,t)},e.stroke=function(){var t=this._getPath();if(0<this.lineWidth){if(-1==this.mId)t.drawLine(0,0,t.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var e=N.getInstance().shapeLineDic[this.mId];e.rebuild(t.tempArray),t.setGeomtry(e)}else N.getInstance().addLine(this.mId,t.drawLine(0,0,t.tempArray,this.lineWidth,this.strokeStyle._color.numColor));t.update();var i=[this.mX,this.mY],r=at.createShape(this,t.ib,t.vb,t.count,t.offset,Et.create(4,0));r.shaderValue.ALPHA=this._shader2D.ALPHA,r.shaderValue.u_pos=i,r.shaderValue.u_mmat2=vt.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=r,this._renderKey=-1}},e.line=function(t,e,i,r,s,a){var n=this._curSubmit,h=this._vb;if(pt.fillLineVb(h,this._clipRect,t,e,i,r,s,a)){this._renderKey=0;var l=this._shader2D,o=n.shaderValue;l.strokeStyle===o.strokeStyle&&l.ALPHA===o.ALPHA||(l.glTexture=null,(n=this._curSubmit=at.createSubmit(this,this._ib,h,(h._byteLength-64)/32*3,Et.create(2,0))).shaderValue.strokeStyle=l.strokeStyle,n.shaderValue.mainID=2,n.shaderValue.ALPHA=l.ALPHA,this._submits[this._submits._length++]=n),n._numEle+=6}},e.moveTo=function(t,e,i){void 0===i&&(i=!0);var r=this._getPath();if(i){var s=t,a=e;t=this._curMat.a*s+this._curMat.c*a,e=this._curMat.b*s+this._curMat.d*a}r.addPoint(t,e)},e.lineTo=function(t,e,i){void 0===i&&(i=!0);var r=this._getPath();if(i){var s=t,a=e;t=this._curMat.a*s+this._curMat.c*a,e=this._curMat.b*s+this._curMat.d*a}r.addPoint(t,e)},e.drawCurves=function(t,e,i){this.setPathId(-1),this.beginPath(),this.strokeStyle=i[3],this.lineWidth=i[4];var r=i[2];t+=i[0],e+=i[1],this.movePath(t,e),this.moveTo(r[0],r[1]);for(var s=2,a=r.length;s<a;)this.quadraticCurveTo(r[s++],r[s++],r[s++],r[s++]);this.stroke()},e.arcTo=function(t,e,i,r,s){if(-1==this.mId||!this.mHaveKey){var a=0,n=0,h=0,l=this._getPath();this._curMat.copyTo(U._tmpMatrix),U._tmpMatrix.tx=U._tmpMatrix.ty=0,U._tempPoint.setTo(l.getEndPointX(),l.getEndPointY()),U._tmpMatrix.invertTransformPoint(U._tempPoint);var o=U._tempPoint.x-t,u=U._tempPoint.y-e,_=Math.sqrt(o*o+u*u);if(!(_<=1e-6)){var c=o/_,f=u/_,d=i-t,m=r-e,p=d*d+m*m,g=Math.sqrt(p);if(!(g<=1e-6)){var v=d/g,x=m/g,b=c+v,y=f+x,T=Math.sqrt(b*b+y*y);if(!(T<=1e-6)){var A=b/T,E=y/T,S=Math.acos(A*c+E*f),w=Math.PI/2-S,R=(_=s/Math.tan(w))*c+t,I=_*f+e,M=Math.sqrt(_*_+s*s),C=t+A*M,L=e+E*M,P=0,D=0;if(0<=c*x-f*v){var F=2*w/U.SEGNUM;P=Math.sin(F),D=Math.cos(F)}else F=2*-w/U.SEGNUM,P=Math.sin(F),D=Math.cos(F);n=this._curMat.a*R+this._curMat.c*I,h=this._curMat.b*R+this._curMat.d*I,n==this._path.getEndPointX()&&h==this._path.getEndPointY()||l.addPoint(n,h);var B=R-C,N=I-L;for(a=0;a<U.SEGNUM;a++){var O=B*D+N*P,V=-B*P+N*D;n=O+C,h=V+L,t=this._curMat.a*n+this._curMat.c*h,h=e=this._curMat.b*n+this._curMat.d*h,(n=t)==this._path.getEndPointX()&&h==this._path.getEndPointY()||l.addPoint(n,h),B=O,N=V}}}}}},e.arc=function(t,e,i,r,s,a,n){if(void 0===a&&(a=!1),void 0===n&&(n=!0),-1!=this.mId){var h=N.getInstance().shapeDic[this.mId];if(h&&this.mHaveKey&&!h.needUpdate(this._curMat))return;e=t=0}var l,o=0,u=0,_=0,c=0,f=0,d=0,m=0;if(u=s-r,a)if(Math.abs(u)>=2*Math.PI)u=2*-Math.PI;else for(;0<u;)u-=2*Math.PI;else if(Math.abs(u)>=2*Math.PI)u=2*Math.PI;else for(;u<0;)u+=2*Math.PI;l=u/(m=i<101?Math.max(10,u*i/5):i<201?Math.max(10,u*i/20):Math.max(10,u*i/40))/2,_=Math.abs(4/3*(1-Math.cos(l))/Math.sin(l)),a&&(_=-_);var p=this._getPath(),g=NaN,v=NaN;for(d=0;d<=m;d++)o=r+u*(d/m),c=t+Math.cos(o)*i,f=e+Math.sin(o)*i,n&&(g=c,v=f,c=this._curMat.a*g+this._curMat.c*v,f=this._curMat.b*g+this._curMat.d*v),c==this._path.getEndPointX()&&f==this._path.getEndPointY()||p.addPoint(c,f);c=t+Math.cos(s)*i,f=e+Math.sin(s)*i,n&&(g=c,v=f,c=this._curMat.a*g+this._curMat.c*v,f=this._curMat.b*g+this._curMat.d*v),c==this._path.getEndPointX()&&f==this._path.getEndPointY()||p.addPoint(c,f)},e.quadraticCurveTo=function(t,e,i,r){var s=u.I,a=i,n=r;i=this._curMat.a*a+this._curMat.c*n,r=this._curMat.b*a+this._curMat.d*n,a=t,n=e,t=this._curMat.a*a+this._curMat.c*n,e=this._curMat.b*a+this._curMat.d*n;for(var h=s.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),t,e,i,r],30,2),l=0,o=h.length/2;l<o;l++)this.lineTo(h[2*l],h[2*l+1],!1);this.lineTo(i,r,!1)},e.rect=function(t,e,i,r){this._other=this._other.make(),this._other.path||(this._other.path=new W),this._other.path.rect(t,e,i,r)},e.strokeRect=function(t,e,i,r,s){var a=.5*s;this.line(t-a,e,t+i+a,e,s,this._curMat),this.line(t+i,e,t+i,e+r,s,this._curMat),this.line(t,e,t,e+r,s,this._curMat),this.line(t-a,e+r,t+i+a,e+r,s,this._curMat)},e.clip=function(){},e.drawPoly=function(t,e,i,r,s,a,n){void 0===n&&(n=!1),this._renderKey=0,this._shader2D.glTexture=null;var h=this._getPath();if(-1==this.mId)h.polygon(t,e,i,r,s||1,a);else if(this.mHaveKey){var l=N.getInstance().shapeDic[this.mId];l.setMatrix(this._curMat),l.rebuild(h.tempArray),h.setGeomtry(l)}else{var o=h.polygon(t,e,i,r,s||1,a);N.getInstance().addShape(this.mId,o),o.setMatrix(this._curMat)}h.update();var u,_=[this.mX,this.mY];if((u=at.createShape(this,h.ib,h.vb,h.count,h.offset,Et.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,u.shaderValue.u_pos=_,u.shaderValue.u_mmat2=vt.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=u,0<s){if(this.mHaveLineKey){var c=N.getInstance().shapeLineDic[this.mId];c.rebuild(h.tempArray),h.setGeomtry(c)}else N.getInstance().addShape(this.mId,h.drawLine(t,e,i,s,a));h.update(),(u=at.createShape(this,h.ib,h.vb,h.count,h.offset,Et.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,u.shaderValue.u_mmat2=vt.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=u}},e.drawParticle=function(t,e,i){i.x=t,i.y=e,this._submits[this._submits._length++]=i},e._getPath=function(){return this._path||(this._path=new W)},r(0,e,"globalCompositeOperation",function(){return G.NAMES[this._nBlendType]},function(t){var e=G.TOINT[t];null==e||this._nBlendType===e||(Y.save(this,65536,this,!0),this._curSubmit=at.RENDERBASE,this._renderKey=0,this._nBlendType=e)}),r(0,e,"strokeStyle",function(){return this._shader2D.strokeStyle},function(t){this._shader2D.strokeStyle.equal(t)||(Y.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=z.create(t))}),r(0,e,"globalAlpha",function(){return this._shader2D.ALPHA},function(t){(t=Math.floor(1e3*t)/1e3)!=this._shader2D.ALPHA&&(Y.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=t)}),r(0,e,"asBitmap",null,function(t){if(t){if(this._targets||(this._targets=new j),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),r(0,e,"fillStyle",function(){return this._shader2D.fillStyle},function(t){this._shader2D.fillStyle.equal(t)||(Y.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=z.create(t))}),r(0,e,"textAlign",function(){return this._other.textAlign},function(t){this._other.textAlign===t||(this._other=this._other.make(),Y.save(this,32768,this._other,!1),this._other.textAlign=t)}),r(0,e,"lineWidth",function(){return this._other.lineWidth},function(t){this._other.lineWidth===t||(this._other=this._other.make(),Y.save(this,256,this._other,!1),this._other.lineWidth=t)}),r(0,e,"textBaseline",function(){return this._other.textBaseline},function(t){this._other.textBaseline===t||(this._other=this._other.make(),Y.save(this,16384,this._other,!1),this._other.textBaseline=t)}),r(0,e,"font",null,function(t){t!=this._other.font.toString()&&(this._other=this._other.make(),Y.save(this,8,this._other,!1),this._other.font===dt.EMPTY?this._other.font=new dt(t):this._other.font.setFont(t))}),U.__init__=function(){i.DEFAULT=new i},U._tempPoint=new w,U._SUBMITVBSIZE=32e3,U._MAXSIZE=99999999,U._RECTVBSIZE=16,U.MAXCLIPRECT=new R(0,0,99999999,99999999),U._COUNT=0,U._tmpMatrix=new S,U.SEGNUM=32,U._contextcount=0,n(U,["_fontTemp",function(){return this._fontTemp=new dt},"_drawStyleTemp",function(){return this._drawStyleTemp=new z(null)}]),U.__init$=function(){i=function(){function t(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=dt.EMPTY}c(t,"");var e=t.prototype;return e.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=dt.EMPTY},e.make=function(){return this===t.DEFAULT?new t:this},t.DEFAULT=null,t}()},U}(),Et=function(t){function r(t,e){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,r.__super.call(this),this.defines=new It,this.position=r._POSITION,this.mainID=t,this.subID=e,this.textureHost=null,this.texture=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=t|e,this._inClassCache=r._cache[this._cacheID],0<t&&!this._inClassCache&&(this._inClassCache=r._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}c(r,"laya.webgl.shader.d2.value.Value2D",V);var e=r.prototype;return e.setValue=function(t){},e.refresh=function(){var t=this.size;return t[0]=vt.width,t[1]=vt.height,this.alpha=this.ALPHA*vt.worldAlpha,this.mmat=vt.worldMatrix4,this},e._ShaderWithCompile=function(){return Qt.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,jt.create)},e._withWorldShaderDefines=function(){var t=vt.worldShaderDefines,e=Qt.sharders[this.mainID|this.defines._value|t.getValue()];if(!e){var i,r={};for(i in this.defines.toNameDic())r[i]="";for(i in t.toNameDic())r[i]="";e=Qt.withCompile2D(0,this.mainID,r,this.mainID|this.defines._value|t.getValue(),jt.create)}var s=vt.worldFilters;if(!s)return e;for(var a,n=s.length,h=0;h<n;h++)(a=s[h])&&a.action.setValue(this);return e},e.upload=function(){var t=vt;this.alpha=this.ALPHA*t.worldAlpha,vt.worldMatrix4!==vt.TEMPMAT4_ARRAY&&this.defines.add(128),bt.shaderHighPrecision&&this.defines.add(1024);var e,i=t.worldShaderDefines?this._withWorldShaderDefines():Qt.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=t.width,this.size[1]=t.height,this.mmat=t.worldMatrix4,Bt.activeShader!==i?i._shaderValueWidth!==t.width||i._shaderValueHeight!==t.height?(i._shaderValueWidth=t.width,i._shaderValueHeight=t.height):e=i._params2dQuick2||i._make2dQuick2():i._shaderValueWidth!==t.width||i._shaderValueHeight!==t.height?(i._shaderValueWidth=t.width,i._shaderValueHeight=t.height):e=i._params2dQuick1||i._make2dQuick1(),i.upload(this,e)},e.setFilters=function(t){if(this.filters=t)for(var e,i=t.length,r=0;r<i;r++)(e=t[r])&&(this.defines.add(e.type),e.action.setValue(this))},e.clear=function(){this.defines.setValue(this.subID)},e.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.clear()},r._initone=function(t,e){r._typeClass[t]=e,r._cache[t]=[],r._cache[t]._length=0},r.__init__=function(){r._POSITION=[2,5126,!1,4*mt.BYTES_PE,0],r._TEXCOORD=[2,5126,!1,4*mt.BYTES_PE,2*mt.BYTES_PE],r._initone(2,Ut),r._initone(4,Gt),r._initone(256,kt),r._initone(512,Vt),r._initone(1,Ht),r._initone(65,qt),r._initone(9,Ht)},r.create=function(t,e){var i=r._cache[t|e];return i._length?i[--i._length]:new r._typeClass[t|e](e)},r._POSITION=null,r._TEXCOORD=null,r._cache=[],r._typeClass=[],r.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r}(),St=function(t){function p(t,e){p.__super.call(this,t,e)}c(p,"laya.webgl.utils.RenderSprite3D",v);var e=p.prototype;return e.onCreate=function(t){switch(t){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},e._mask=function(t,e,i,r){var s,a,n=this._next,h=t.mask;if(h){e.ctx.save();var l=e.ctx.globalCompositeOperation,o=new R;if(o.copyFrom(h.getBounds()),o.width=Math.round(o.width),o.height=Math.round(o.height),o.x=Math.round(o.x),o.y=Math.round(o.y),0<o.width&&0<o.height){var u=t._style._tf,_=ht.create();_.addValue("bounds",o),s=nt.create([_,e],laya.webgl.utils.RenderSprite3D.tmpTarget),e.addRenderObject(s),h.render(e,-o.x,-o.y),s=nt.create([_],laya.webgl.utils.RenderSprite3D.endTmpTarget),e.addRenderObject(s),e.ctx.save(),e.clipRect(i-u.translateX+o.x,r-u.translateY+o.y,o.width,o.height),n._fun.call(n,t,e,i,r),e.ctx.restore(),a=ut.create(6),l=e.ctx.globalCompositeOperation,a.blendMode="mask",e.addRenderObject(a),S.TEMP.identity();var c=Et.create(1,0),f=F.INV_UV,d=o.width,m=o.height;(o.width<32||o.height<32)&&((f=p.tempUV)[0]=0,f[1]=0,f[2]=32<=o.width?1:o.width/32,f[3]=0,f[4]=32<=o.width?1:o.width/32,f[5]=32<=o.height?1:o.height/32,f[6]=0,f[7]=32<=o.height?1:o.height/32,o.width=32<=o.width?o.width:32,o.height=32<=o.height?o.height:32,f[1]*=-1,f[3]*=-1,f[5]*=-1,f[7]*=-1,f[1]+=1,f[3]+=1,f[5]+=1,f[7]+=1),e.ctx.drawTarget(_,i+o.x-u.translateX,r+o.y-u.translateY,d,m,S.TEMP,"tmpTarget",c,f,6),s=nt.create([_],laya.webgl.utils.RenderSprite3D.recycleTarget),e.addRenderObject(s),(a=ut.create(6)).blendMode=l,e.addRenderObject(a)}e.ctx.restore()}else n._fun.call(n,t,e,i,r)},e._blend=function(t,e,i,r){var s=t._style,a=this._next;s.blendMode?(e.ctx.save(),e.ctx.globalCompositeOperation=s.blendMode,a._fun.call(a,t,e,i,r),e.ctx.restore()):a._fun.call(a,t,e,i,r)},e._transform=function(t,e,i,r){var s=t.transform,a=this._next;if(s&&a!=v.NORENDER){var n=e.ctx;t._style;s.tx=i,s.ty=r;var h=n._getTransformMatrix(),l=h.clone();S.mul(s,h,h),h._checkTransform(),s.tx=s.ty=0,a._fun.call(a,t,e,0,0),l.copyTo(h),l.destroy()}else a._fun.call(a,t,e,i,r)},p.tmpTarget=function(t,e){var i=t.getValue("bounds"),r=Nt.create(i.width,i.height);r.start(),r.clear(0,0,0,0),t.addValue("tmpTarget",r)},p.endTmpTarget=function(t){t.getValue("tmpTarget").end()},p.recycleTarget=function(t){t.getValue("tmpTarget").recycle(),t.recycle()},n(p,["tempUV",function(){return this.tempUV=new Array(8)}]),p}(),wt=function(t){function e(){this.data=null,e.__super.call(this)}c(e,"laya.filters.webgl.ColorFilterActionGL",O);var i=e.prototype;return T.imps(i,{"laya.filters.IFilterActionGL":!0}),i.setValue=function(t){t.colorMat=this.data._mat,t.colorAlpha=this.data._alpha},i.apply3d=function(t,e,i,r,s){var a=t.getValue("bounds"),n=Et.create(1,0);n.setFilters([this.data]);var h=S.TEMP;h.identity(),i.ctx.drawTarget(t,0,0,a.width,a.height,h,"src",n)},e}(),Rt=function(t){function a(t,e,i,r,s){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,a.__super.call(this,t,e,s),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new zt,(this._atlasCanvas._atlaser=this)._atlasCanvas.width=i,this._atlasCanvas.height=r,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}c(a,"laya.webgl.atlas.Atlaser",U);var e=a.prototype;return e.computeUVinAtlasTexture=function(t,e,i,r){var s=k.atlasTextureWidth,a=k.atlasTextureHeight,n=i/s,h=r/a,l=(i+t.bitmap.width)/s,o=(r+t.bitmap.height)/a,u=t.bitmap.width/s,_=t.bitmap.height/a;t.uv=[n+e[0]*u,h+e[1]*_,l-(1-e[2])*u,h+e[3]*_,l-(1-e[4])*u,o-(1-e[5])*_,n+e[6]*u,o-(1-e[7])*_]},e.findBitmapIsExist=function(t){if(t instanceof laya.webgl.resource.WebGLImage){var e=t,i=e.url,r=this._InAtlasWebGLImagesKey[i||e.id];if(r)return r.offsetInfoID}return-1},e.addToAtlasTexture=function(t,e,i){if(t instanceof laya.webgl.resource.WebGLImage){var r=t,s=r.url;this._InAtlasWebGLImagesKey[s||r.id]={bitmap:t,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([e,i])}this._atlasCanvas.texSubImage2D(e,i,t.atlasImgData||t.atlasSource),t.clearAtlasSource()},e.addToAtlas=function(t,e,i){t._atlasID=this._inAtlasTextureKey.length;var r=t.uv.slice(),s=t.bitmap;this._inAtlasTextureKey.push(t),this._inAtlasTextureOriUVValue.push(r),this._inAtlasTextureBitmapValue.push(s),this.computeUVinAtlasTexture(t,r,e,i),t.bitmap=this._atlasCanvas},e.clear=function(){for(var t=0,e=this._inAtlasTextureKey.length;t<e;t++)this._inAtlasTextureKey[t].bitmap=this._inAtlasTextureBitmapValue[t],this._inAtlasTextureKey[t].uv=this._inAtlasTextureOriUVValue[t],this._inAtlasTextureKey[t]._atlasID=-1,this._inAtlasTextureKey[t].bitmap.lock=!1,this._inAtlasTextureKey[t].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},e.dispose=function(){this.clear(),this._atlasCanvas.destroy()},r(0,e,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),r(0,e,"texture",function(){return this._atlasCanvas}),r(0,e,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),a}(),It=function(t){function i(){i.__super.call(this,i.__name2int,i.__int2name,i.__int2nameMap)}return c(i,"laya.webgl.shader.d2.ShaderDefines2D",J),i.__init__=function(){i.reg("TEXTURE2D",1),i.reg("COLOR2D",2),i.reg("PRIMITIVE",4),i.reg("GLOW_FILTER",8),i.reg("BLUR_FILTER",16),i.reg("COLOR_FILTER",32),i.reg("COLOR_ADD",64),i.reg("WORLDMAT",128),i.reg("FILLTEXTURE",256),i.reg("FSHIGHPRECISION",1024)},i.reg=function(t,e){J._reg(t,e,i.__name2int,i.__int2name)},i.toText=function(t,e,i){return J._toText(t,e,i)},i.toInt=function(t){return J._toInt(t,i.__name2int)},i.TEXTURE2D=1,i.COLOR2D=2,i.PRIMITIVE=4,i.FILTERGLOW=8,i.FILTERBLUR=16,i.FILTERCOLOR=32,i.COLORADD=64,i.WORLDMAT=128,i.FILLTEXTURE=256,i.SKINMESH=512,i.SHADERDEFINE_FSHIGHPRECISION=1024,i.__name2int={},i.__int2name=[],i.__int2nameMap=[],i}(),Mt=(function(t){function h(t,e,i,r,s,a,n){h.__super.call(this,t,e,i,r,40,s,a,n)}c(h,"laya.webgl.shapes.Ellipse",it)}(),function(t){function a(t,e,i,r,s){this._points=[],this.rebuild(i),a.__super.call(this,t,e,0,0,0,s,r,s,0)}c(a,"laya.webgl.shapes.Line",it);var e=a.prototype;return e.rebuild=function(t){var e=t.length;e!=this._points.length&&(this.mUint16Array=new Uint16Array(6*(e/2-1)),this.mFloat32Array=new Float32Array(5*e)),this._points.length=0;for(var i=NaN,r=NaN,s=-1,a=-1,n=t.length/2,h=0;h<n;h++)i=t[2*h],r=t[2*h+1],(.01<Math.abs(s-i)||.01<Math.abs(a-r))&&this._points.push(i,r),s=i,a=r},e.getData=function(t,e,i){var r=[],s=[];0<this.borderWidth&&this.createLine2(this._points,r,this.borderWidth,i,s,this._points.length/2),this.mUint16Array.set(r,0),this.mFloat32Array.set(s,0),t.append(this.mUint16Array),e.append(this.mFloat32Array)},a}()),Ct=function(t){function _(t,e,i,r,s){this._points=[];for(var a=NaN,n=NaN,h=-1,l=-1,o=i.length/2-1,u=0;u<o;u++)a=i[2*u],n=i[2*u+1],(.01<Math.abs(h-a)||.01<Math.abs(l-n))&&this._points.push(a,n),h=a,l=n;a=i[2*o],n=i[2*o+1],h=this._points[0],l=this._points[1],(.01<Math.abs(h-a)||.01<Math.abs(l-n))&&this._points.push(a,n),_.__super.call(this,t,e,0,0,this._points.length/2,0,r,s)}c(_,"laya.webgl.shapes.LoopLine",it);var e=_.prototype;return e.getData=function(t,e,i){if(0<this.borderWidth){for(var r=this.color,s=(r>>16&255)/255,a=(r>>8&255)/255,n=(255&r)/255,h=[],l=0,o=0,u=[],_=Math.floor(this._points.length/2),c=0;c<_;c++)l=this._points[2*c],o=this._points[2*c+1],h.push(this.x+l,this.y+o,s,a,n);this.createLoopLine(h,u,this.borderWidth,i+h.length/5),t.append(new Uint16Array(u)),e.append(new Float32Array(h))}},e.createLoopLine=function(t,e,i,r,s,a){t.length;var n=t.concat(),h=s||t,l=this.borderColor,o=(l>>16&255)/255,u=(l>>8&255)/255,_=(255&l)/255,c=[n[0],n[1]],f=[n[n.length-5],n[n.length-4]],d=f[0]+.5*(c[0]-f[0]),m=f[1]+.5*(c[1]-f[1]);n.unshift(d,m,0,0,0),n.push(d,m,0,0,0);var p,g,v,x,b,y,T,A,E,S,w,R,I,M,C,L,P,D,F,B,N=n.length/5,O=r,V=i/2;v=n[0],x=n[1],S=v-(b=n[5]),E=(E=-(x-(y=n[6])))/(B=Math.sqrt(E*E+S*S))*V,S=S/B*V,h.push(v-E,x-S,o,u,_,v+E,x+S,o,u,_);for(var U=1;U<N-1;U++)v=n[5*(U-1)],x=n[5*(U-1)+1],b=n[5*U],y=n[5*U+1],T=n[5*(U+1)],A=n[5*(U+1)+1],S=v-b,R=b-T,C=(-(E=(E=-(x-y))/(B=Math.sqrt(E*E+S*S))*V)+v)*(-(S=S/B*V)+y)-(-E+b)*(-S+x),D=(-(w=(w=-(y-A))/(B=Math.sqrt(w*w+R*R))*V)+T)*(-(R=R/B*V)+y)-(-w+b)*(-R+A),F=(I=-S+x-(-S+y))*(P=-w+b-(-w+T))-(L=-R+A-(-R+y))*(M=-E+b-(-E+v)),Math.abs(F)<.1?(F+=10.1,h.push(b-E,y-S,o,u,_,b+E,y+S,o,u,_)):(((p=(M*D-P*C)/F)-b)*(p-b)+((g=(L*C-I*D)/F)-y)+(g-y),h.push(p,g,o,u,_,b-(p-b),y-(g-y),o,u,_));a&&(e=a);var k=this.edges+1;for(U=1;U<k;U++)e.push(O+2*(U-1),O+2*(U-1)+1,O+2*U+1,O+2*U+1,O+2*U,O+2*(U-1));return e.push(O+2*(U-1),O+2*(U-1)+1,O+1,O+1,O,O+2*(U-1)),h},_}(),Lt=function(t){function n(t,e,i,r,s,a){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=S.create(),this._points=i.slice(0,i.length),n.__super.call(this,t,e,0,0,this._points.length/2,r,s,a)}c(n,"laya.webgl.shapes.Polygon",it);var e=n.prototype;return e.rebuild=function(t){this._repaint||(this._points.length=0,this._points=this._points.concat(t))},e.setMatrix=function(t){t.copyTo(this._mat)},e.needUpdate=function(t){return this._repaint=this._mat.a==t.a&&this._mat.b==t.b&&this._mat.c==t.c&&this._mat.d==t.d&&this._mat.tx==t.tx&&this._mat.ty==t.ty,!this._repaint},e.getData=function(t,e,i){var r,s=0,a=this._points,n=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=i){for(this._start=i,r=[],n=this.earcutTriangles.length,s=0;s<n;s++)r.push(this.earcutTriangles[s]+i);this.mUint16Array=new Uint16Array(r)}}else{this._start=i,r=[];var h=[],l=[],o=this.color,u=(o>>16&255)/255,_=(o>>8&255)/255,c=(255&o)/255;for(n=Math.floor(a.length/2),s=0;s<n;s++)h.push(this.x+a[2*s],this.y+a[2*s+1],u,_,c),l.push(this.x+a[2*s],this.y+a[2*s+1]);for(this.earcutTriangles=rt.earcut(l,null,2),n=this.earcutTriangles.length,s=0;s<n;s++)r.push(this.earcutTriangles[s]+i);this.mUint16Array=new Uint16Array(r),this.mFloat32Array=new Float32Array(h)}t.append(this.mUint16Array),e.append(this.mFloat32Array)},n}(),Pt=function(t){function a(){this._matrix=new S,this._matrix4=mt.defaultMatrix4.concat(),a.__super.call(this,1e4),this.shaderValue=new Et(0,0)}c(a,"laya.webgl.submit.SubmitCanvas",at);var e=a.prototype;return e.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var t=vt.worldAlpha,e=vt.worldMatrix4,i=vt.worldMatrix,r=vt.worldFilters,s=vt.worldShaderDefines,a=this.shaderValue,n=this._matrix,h=this._matrix4,l=S.TEMP;return S.mul(n,i,l),h[0]=l.a,h[1]=l.b,h[4]=l.c,h[5]=l.d,h[12]=l.tx,h[13]=l.ty,vt.worldMatrix=l.clone(),vt.worldMatrix4=h,vt.worldAlpha=vt.worldAlpha*a.alpha,a.filters&&a.filters.length&&(vt.worldFilters=a.filters,vt.worldShaderDefines=a.defines),this._ctx_src.flush(),vt.worldAlpha=t,vt.worldMatrix4=e,vt.worldMatrix.destroy(),vt.worldMatrix=i,vt.worldFilters=r,vt.worldShaderDefines=s,1},e.releaseRender=function(){var t=a._cache;this._ctx_src=null,t[t._length++]=this},e.getRenderType=function(){return 10003},a.create=function(t,e,i){var r=a._cache._length?a._cache[--a._cache._length]:new a;r._ctx_src=t;var s=r.shaderValue;return s.alpha=e,s.defines.setValue(0),i&&i.length&&s.setFilters(i),r},a._cache=((a._cache=[])._length=0,a._cache),a}(),Dt=function(t){function o(t){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===t&&(t=1e4),o.__super.call(this,t)}c(o,"laya.webgl.submit.SubmitTexture",at);var e=o.prototype;return e.releaseRender=function(){var t=o._cache;(t[t._length++]=this).shaderValue.release(),this._preIsSameTextureShader=!1,this._vb=null,this._texs.length=0,this._vbPos.length=0,this._isSameTexture=!0},e.addTexture=function(t,e){this._texsID[this._texs.length]=t._uvID,this._texs.push(t),this._vbPos.push(e)},e.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var t=this.shaderValue.textureHost.bitmap;if(null!==t)for(var e=this._vb.getFloat32Array(),i=0,r=this._texs.length;i<r;i++){var s=this._texs[i];s.active();var a=s.uv;if(this._texsID[i]!==s._uvID){this._texsID[i]=s._uvID;var n=this._vbPos[i];e[n+2]=a[0],e[n+3]=a[1],e[n+6]=a[2],e[n+7]=a[3],e[n+10]=a[4],e[n+11]=a[5],e[n+14]=a[6],e[n+15]=a[7],this._vb.setNeedUpload()}s.bitmap!==t&&(this._isSameTexture=!1)}}},e.renderSubmit=function(){if(0===this._numEle)return o._shaderSet=!1,1;var t=this.shaderValue.textureHost;if(t){var e=t.source;if(!t.bitmap||!e)return o._shaderSet=!1,1;this.shaderValue.texture=e}this._vb.bind_upload(this._ib);var i=bt.mainContext;if(G.activeBlendFunction!==this._blendFn&&(i.enable(3042),this._blendFn(i),G.activeBlendFunction=this._blendFn),C.drawCall++,C.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&Bt.activeShader&&o._shaderSet?Bt.activeShader.uploadTexture2D(this.shaderValue.texture):this.shaderValue.upload(),o._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var r=t.bitmap,s=0,a=Bt.activeShader,n=0,h=this._texs.length;n<h;n++){var l=this._texs[n];l.bitmap===r&&n+1!==h||(a.uploadTexture2D(l.source),i.drawElements(4,6*(n-s+1),5123,this._startIdx+6*s*mt.BYTES_PIDX),r=l.bitmap,s=n)}else i.drawElements(4,this._numEle,5123,this._startIdx);return 1},o.create=function(t,e,i,r,s){var a=o._cache._length?o._cache[--o._cache._length]:new o;null==i&&((i=a._selfVb||(a._selfVb=Jt.create(-1))).clear(),r=0),a._ib=e,a._vb=i,a._startIdx=r*mt.BYTES_PIDX,a._numEle=0;var n=t._nBlendType;a._blendFn=t._targets?G.targetFns[n]:G.fns[n],a.shaderValue=s,a.shaderValue.setValue(t._shader2D);var h=t._shader2D.filters;return h&&a.shaderValue.setFilters(h),a},o._cache=((o._cache=[])._length=0,o._cache),o._shaderSet=!0,o}(),Ft=function(t){function v(){v.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}c(v,"laya.webgl.utils.MeshTexture",gt);var e=v.prototype;return e.addData=function(t,e,i,r,s,a){for(var n=t.length/2,h=this._vb.needSize(n*v.const_stride)>>2,l=this._vb.getFloat32Array(),o=0,u=0;u<n;u++){var _=t[o],c=t[o+1],f=_*r.a+c*r.c+r.tx,d=_*r.b+c*r.d+r.ty;l[h++]=f,l[h++]=d,l[h++]=e[o],l[h++]=e[o+1],o+=2}this._vb.setNeedUpload();var m=this.vertNum;if(0<m){var p=i.length;p>v.tmpIdx.length&&(v.tmpIdx=new Uint16Array(p));for(var g=0;g<p;g++)v.tmpIdx[g]=i[g]+m;this._ib.appendU16Array(v.tmpIdx,i.length)}else this._ib.append(i);this._ib.setNeedUpload(),this.vertNum+=n,this.indexNum+=i.length},e.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy()},v.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new v},v.const_stride=16,v._POOL=[],n(v,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),v}(),Bt=function(t){function e(){e.__super.call(this),this.lock=!0}return c(e,"laya.webgl.shader.BaseShader",x),e.activeShader=null,e.bindShader=null,e}(),Nt=function(e){function u(t,e,i,r,s,a,n,h,l){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===i&&(i=6408),void 0===r&&(r=5121),void 0===s&&(s=34041),void 0===a&&(a=!1),void 0===n&&(n=!1),void 0===h&&(h=-1),void 0===l&&(l=-1),this._type=1,this._w=t,this._h=e,this._surfaceFormat=i,this._surfaceType=r,this._depthStencilFormat=s,g.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=a,this._repeat=n,this._minFifter=h,this._magFifter=l,this._createWebGLRenderTarget(),this.bitmap.lock=!0,u.__super.call(this,this.bitmap,F.INV_UV)}c(u,"laya.webgl.resource.RenderTarget2D",e);var t=u.prototype;return T.imps(t,{"laya.resource.IDispose":!0}),t.getType=function(){return this._type},t.getTexture=function(){return this},t.size=function(t,e){this._w==t&&this._h==e||(this._w=t,this._h=e,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},t.release=function(){this.destroy()},t.recycle=function(){u.POOL.push(this)},t.start=function(){var t=bt.mainContext;return this._preRenderTarget=vt.curRenderTarget,vt.curRenderTarget=this,t.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&(t.viewport(0,0,this._w,this._h),this._svWidth=vt.width,this._svHeight=vt.height,vt.width=this._w,vt.height=this._h,Bt.activeShader=null),this},t.clear=function(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1);var s=bt.mainContext;s.clearColor(t,e,i,r);var a=16384;switch(this._depthStencilFormat){case 33189:a|=256;break;case 36168:a|=1024;break;case 34041:a|=256,a|=1024}s.clear(a)},t.end=function(){var t=bt.mainContext;t.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,vt.curRenderTarget=this._preRenderTarget,1==this._type?(t.viewport(0,0,this._svWidth,this._svHeight),vt.width=this._svWidth,vt.height=this._svHeight,Bt.activeShader=null):t.viewport(0,0,T.stage.width,T.stage.height)},t.getData=function(t,e,i,r){var s=bt.mainContext;if(s.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053===s.checkFramebufferStatus(36160)))return s.bindFramebuffer(36160,null),null;var a=new Uint8Array(this._w*this._h*4);return s.readPixels(t,e,i,r,this._surfaceFormat,this._surfaceType,a),s.bindFramebuffer(36160,null),a},t.destroy=function(t){void 0===t&&(t=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,e.prototype.destroy.call(this))},t.dispose=function(){},t._createWebGLRenderTarget=function(){this.bitmap=new Xt(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function(t){this.event("recovered")})},r(0,t,"surfaceFormat",function(){return this._surfaceFormat}),r(0,t,"magFifter",function(){return this._magFifter}),r(0,t,"surfaceType",function(){return this._surfaceType}),r(0,t,"mipMap",function(){return this._mipMap}),r(0,t,"depthStencilFormat",function(){return this._depthStencilFormat}),r(0,t,"minFifter",function(){return this._minFifter}),r(0,t,"source",function(){return this._alreadyResolved?T.superGet(F,this,"source"):null}),u.create=function(t,e,i,r,s,a,n,h,l){void 0===i&&(i=6408),void 0===r&&(r=5121),void 0===s&&(s=34041),void 0===a&&(a=!1),void 0===n&&(n=!1),void 0===h&&(h=-1),void 0===l&&(l=-1);var o=u.POOL.pop();return o||(o=new u(t,e)),o.bitmap&&o._w==t&&o._h==e&&o._surfaceFormat==i&&o._surfaceType==r&&o._depthStencilFormat==s&&o._mipMap==a&&o._repeat==n&&o._minFifter==h&&o._magFifter==l||(o._w=t,o._h=e,o._surfaceFormat=i,o._surfaceType=r,o._depthStencilFormat=s,g.isConchWebGL&&34041===o._depthStencilFormat&&(o._depthStencilFormat=33189),o._mipMap=a,o._repeat=n,o._minFifter=h,o._magFifter=l,o.release(),o._createWebGLRenderTarget()),o},u.TYPE2D=1,u.TYPE3D=2,u.POOL=[],u}(F),Ot=function(t){function e(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,e.__super.call(this),e._gl=bt.mainContext}c(e,"laya.webgl.utils.Buffer",x);var i=e.prototype;return i._bind=function(){this.activeResource(),e._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&(e._bindVertexBuffer=this._glBuffer),e._gl.bindBuffer(this._bufferType,e._bindActive[this._bufferType]=this._glBuffer),Bt.activeShader=null)},i.recreateResource=function(){this._glBuffer||(this._glBuffer=e._gl.createBuffer()),this.completeCreate()},i.disposeResource=function(){this._glBuffer&&(bt.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},r(0,i,"bufferUsage",function(){return this._bufferUsage}),e._gl=null,e._bindActive={},e._bindVertexBuffer=null,e._enableAtributes=[],e}(),Vt=function(t){function i(t){this.texcoord=null,this.offsetX=300,this.offsetY=0,i.__super.call(this,512,0);var e=8*mt.BYTES_PE;this.position=[2,5126,!1,e,0],this.texcoord=[2,5126,!1,e,2*mt.BYTES_PE],this.color=[4,5126,!1,e,4*mt.BYTES_PE]}return c(i,"laya.webgl.shader.d2.skinAnishader.SkinSV",Et),i}(),Ut=function(t){function e(t){e.__super.call(this,2,0),this.color=[]}return c(e,"laya.webgl.shader.d2.value.Color2dSV",Et),e.prototype.setValue=function(t){t.fillStyle&&(this.color=t.fillStyle._color._color),t.strokeStyle&&(this.color=t.strokeStyle._color._color)},e}(),kt=function(t){function e(t){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=Et._TEXCOORD,e.__super.call(this,256,0)}c(e,"laya.webgl.shader.d2.value.FillTextureSV",Et);var i=e.prototype;return i.setValue=function(t){this.ALPHA=t.ALPHA,t.filters&&this.setFilters(t.filters)},i.clear=function(){this.texture=null,this.shader=null,this.defines.setValue(0)},e}(),Ht=function(t){function e(t){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=Et._TEXCOORD,void 0===t&&(t=0),e.__super.call(this,1,t)}c(e,"laya.webgl.shader.d2.value.TextureSV",Et);var i=e.prototype;return i.setValue=function(t){this.ALPHA=t.ALPHA,t.filters&&this.setFilters(t.filters)},i.clear=function(){this.texture=null,this.shader=null,this.defines.setValue(0)},e}(),Gt=function(t){function e(t){this.a_color=null,this.u_pos=[0,0],e.__super.call(this,4,0),this.position=[2,5126,!1,5*mt.BYTES_PE,0],this.a_color=[3,5126,!1,5*mt.BYTES_PE,2*mt.BYTES_PE]}return c(e,"laya.webgl.shader.d2.value.PrimitiveSV",Et),e}(),zt=function(t){function e(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,e.__super.call(this)}c(e,"laya.webgl.atlas.AtlasWebGLCanvas",t);var i=e.prototype;return i.recreateResource=function(){var t=bt.mainContext,e=this._source=t.createTexture(),i=yt.curBindTexTarget,r=yt.curBindTexValue;yt.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),i&&r&&yt.bindTexture(t,i,r),this.memorySize=this._w*this._h*4,this.completeCreate()},i.disposeResource=function(){this._source&&(bt.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},i.texSubImage2D=function(t,e,i){if(g.isFlash){this._flashCacheImage||(this._flashCacheImage=m.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var r=i.bitmapdata;this._flashCacheImage._image.copyPixels(r,0,0,r.width,r.height,t,e),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var s=bt.mainContext,a=yt.curBindTexTarget,n=yt.curBindTexValue;yt.bindTexture(s,3553,this._source),g.isConchWebGL?(i!==ConchTextCanvas&&(0<=t-1&&s.texSubImage2DEx(!0,3553,0,t-1,e,6408,5121,i),t+1<=this._w&&s.texSubImage2DEx(!0,3553,0,t+1,e,6408,5121,i),0<=e-1&&s.texSubImage2DEx(!0,3553,0,t,e-1,6408,5121,i),e+1<=this._h&&s.texSubImage2DEx(!0,3553,0,t,e+1,6408,5121,i)),s.texSubImage2DEx(!0,3553,0,t,e,6408,5121,i)):(s.pixelStorei(37441,!0),0<=t-1&&s.texSubImage2D(3553,0,t-1,e,6408,5121,i),t+1<=this._w&&s.texSubImage2D(3553,0,t+1,e,6408,5121,i),0<=e-1&&s.texSubImage2D(3553,0,t,e-1,6408,5121,i),e+1<=this._h&&s.texSubImage2D(3553,0,t,e+1,6408,5121,i),s.texSubImage2D(3553,0,t,e,6408,5121,i),s.pixelStorei(37441,!1)),a&&n&&yt.bindTexture(s,a,n)}},i.texSubImage2DPixel=function(t,e,i,r,s){var a=bt.mainContext,n=yt.curBindTexTarget,h=yt.curBindTexValue;yt.bindTexture(a,3553,this._source);var l=new Uint8Array(s.data);g.isConchWebGL?a.texSubImage2DEx(!0,3553,0,t,e,i,r,6408,5121,l):(a.pixelStorei(37441,!0),a.texSubImage2D(3553,0,t,e,i,r,6408,5121,l),a.pixelStorei(37441,!1)),n&&h&&yt.bindTexture(a,n,h)},r(0,i,"width",t.prototype._$get_width,function(t){this._w=t}),r(0,i,"height",t.prototype._$get_height,function(t){this._h=t}),e}(i),Wt=function(t){function s(){this.flipY=!0,this.alwaysChange=!1,s.__super.call(this)}c(s,"laya.webgl.resource.WebGLCanvas",i);var e=s.prototype;return e.getCanvas=function(){return this._canvas},e.clear=function(){this._ctx&&this._ctx.clear()},e.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},e._setContext=function(t){this._ctx=t},e.getContext=function(t,e){return this._ctx?this._ctx:this._ctx=s._createContext(this)},e.size=function(t,e){this._w==t&&this._h==e||(this._w=t,this._h=e,this._ctx&&this._ctx.size(t,e),this._canvas&&(this._canvas.height=e,this._canvas.width=t))},e.activeResource=function(t){void 0===t&&(t=!1),this._source||this.recreateResource()},e.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},e.disposeResource=function(){this._source&&!this.iscpuSource&&(bt.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},e.createWebGlTexture=function(){var t=bt.mainContext;this._canvas;var e=this._source=t.createTexture();this.iscpuSource=!1;var i=yt.curBindTexTarget,r=yt.curBindTexValue;yt.bindTexture(t,3553,e),t.pixelStorei(37440,this.flipY?1:0),g.isConchWebGL?t.texImage2DEx(s.premulAlpha,3553,0,6408,6408,5121,this._imgData):(s.premulAlpha&&t.pixelStorei(37441,!0),t.texImage2D(3553,0,6408,6408,5121,this._imgData),s.premulAlpha&&t.pixelStorei(37441,!1)),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),t.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,i&&r&&yt.bindTexture(t,i,r)},e.reloadCanvasData=function(){var t=bt.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var e=yt.curBindTexTarget,i=yt.curBindTexValue;yt.bindTexture(t,3553,this._source),g.isConchWebGL?t.texImage2DEx(s.premulAlpha,3553,0,6408,6408,5121,this._imgData):(s.premulAlpha&&t.pixelStorei(37441,!0),t.texImage2D(3553,0,6408,6408,5121,this._imgData),s.premulAlpha&&t.pixelStorei(37441,!1)),t.pixelStorei(37440,0),e&&i&&yt.bindTexture(t,e,i)},e.texSubImage2D=function(t,e,i){var r=bt.mainContext,s=yt.curBindTexTarget,a=yt.curBindTexValue;yt.bindTexture(r,3553,this._source),g.isConchWebGL?r.texSubImage2DEx(!0,3553,0,e,i,6408,5121,t._source):(r.pixelStorei(37441,!0),r.texSubImage2D(3553,0,e,i,6408,5121,t._source),r.pixelStorei(37441,!1)),s&&a&&yt.bindTexture(r,s,a)},e.toBase64=function(t,e,i){var r=null;this._canvas&&(r=this._canvas.toDataURL(t,e)),i.call(this,r)},r(0,e,"context",function(){return this._ctx}),r(0,e,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),r(0,e,"asBitmap",null,function(t){this._ctx&&(this._ctx.asBitmap=t)}),s._createContext=null,s.premulAlpha=!1,s}(),Yt=function(t){function a(t,e){this.CborderSize=12,a.__super.call(this),this.char=t,this.isSpace=" "===t,this.xs=e.scaleX,this.ys=e.scaleY,this.font=e.font.toString(),this.fontSize=e.font.size,this.fillColor=e.fillColor,this.borderColor=e.borderColor,this.lineWidth=e.lineWidth,this.underLine=e.underLine;var i,r=g.isConchApp;r?((i=ConchTextCanvas)._source=ConchTextCanvas,i._source.canvas=ConchTextCanvas):i=f.canvas.source,this.canvas=i,this._enableMerageInAtlas=!0,this._ctx=r?i:this.canvas.getContext("2d",void 0);var s=B.measureText(this.char,this.font);this.cw=s.width*this.xs,this.ch=(s.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new F(this)}c(a,"laya.webgl.resource.WebGLCharImage",i);var e=a.prototype;return T.imps(e,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),e.active=function(){this.texture.active()},e.recreateResource=function(){var t=g.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),t){var e=this.fontSize;1==this.xs&&1==this.ys||(e=parseInt(e*(this.xs>this.ys?this.xs:this.ys)+""));var i="normal 100 "+this.font;i=i.replace(a._fontSizeReg,e),this.borderColor&&(i+=" 1 "+this.borderColor),this._ctx.font=i,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)}else{if(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,D.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.setTransform(this.xs,0,0,this.ys,0,0),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var r=this._ctx.measureText(this.char).width+1;this._ctx.lineTo(r,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},e.onresize=function(t,e){this._w=t,this._h=e,this._allowMerageInAtlas=!0},e.clearAtlasSource=function(){},r(0,e,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),r(0,e,"atlasSource",function(){return this.canvas}),r(0,e,"atlasImgData",function(){return!a.canUseCanvas&&this._ctx.getImageData?this._ctx.getImageData(0,0,this._w,this._h):null}),r(0,e,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(t){this._enableMerageInAtlas=t}),a.createOneChar=function(t,e){return new a(t,e)},a.canUseCanvas=!0,a._fontSizeReg=new RegExp("\\d+(?=px)","g"),a}(),Xt=function(t){function o(t,e,i,r,s,a,n,h,l){void 0===i&&(i=6408),void 0===r&&(r=5121),void 0===s&&(s=34041),void 0===a&&(a=!1),void 0===n&&(n=!1),void 0===h&&(h=-1),void 0===l&&(l=1),o.__super.call(this),this._w=t,this._h=e,this._surfaceFormat=i,this._surfaceType=r,this._depthStencilFormat=s,g.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=a,this._repeat=n,this._minFifter=h,this._magFifter=l}c(o,"laya.webgl.resource.WebGLRenderTarget",i);var e=o.prototype;return e.recreateResource=function(){var t=bt.mainContext;this._frameBuffer||(this._frameBuffer=t.createFramebuffer()),this._source||(this._source=t.createTexture());var e=yt.curBindTexTarget,i=yt.curBindTexValue;yt.bindTexture(t,3553,this._source),t.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var r=this._minFifter,s=this._magFifter,a=this._repeat?10497:33071,n=l.isPOT(this._w,this._h);if(n?(this._mipMap?-1!==r||(r=9987):-1!==r||(r=9729),-1!==s||(s=9729),t.texParameteri(3553,10241,r),t.texParameteri(3553,10240,s),t.texParameteri(3553,10242,a),t.texParameteri(3553,10243,a),this._mipMap&&t.generateMipmap(3553)):(-1!==r||(r=9729),-1!==s||(s=9729),t.texParameteri(3553,10241,r),t.texParameteri(3553,10240,s),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),t.bindFramebuffer(36160,this._frameBuffer),t.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=t.createRenderbuffer()),t.bindRenderbuffer(36161,this._depthStencilBuffer),t.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:t.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:t.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:t.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}t.bindFramebuffer(36160,null),e&&i&&yt.bindTexture(t,e,i),t.bindRenderbuffer(36161,null),n&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},e.disposeResource=function(){this._frameBuffer&&(bt.mainContext.deleteTexture(this._source),bt.mainContext.deleteFramebuffer(this._frameBuffer),bt.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0)},r(0,e,"depthStencilBuffer",function(){return this._depthStencilBuffer}),r(0,e,"frameBuffer",function(){return this._frameBuffer}),o}(),Kt=function(t){function h(t,e,i,r,s,a,n){this.offsetX=0,this.offsetY=0,h.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=a,this.canvas=t,this._ctx=t.getContext("2d",void 0),this._w=r,this._h=s,this.offsetX=e,this.offsetY=i,this.src=n,this._enableMerageInAtlas=!0,k.enabled&&this._w<k.atlasLimitWidth&&this._h<k.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}c(h,"laya.webgl.resource.WebGLSubImage",i);var e=h.prototype;return T.imps(e,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),e.size=function(t,e){this._w=t,this._h=e,this._ctx&&this._ctx.size(t,e),this.canvas&&(this.canvas.height=e,this.canvas.width=t)},e.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},e.createWebGlTexture=function(){var t=bt.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var e=this._source=t.createTexture(),i=yt.curBindTexTarget,r=yt.curBindTexValue;yt.bindTexture(t,3553,e),g.isConchWebGL?t.texImage2DEx(!0,3553,0,6408,6408,5121,this.canvas):(t.pixelStorei(37441,!0),t.texImage2D(3553,0,6408,6408,5121,this.canvas),t.pixelStorei(37441,!1));var s=this.minFifter,a=this.magFifter,n=this.repeat?10497:33071,h=l.isPOT(this.width,this.height);h?(this.mipmap?-1!==s||(s=9987):-1!==s||(s=9729),-1!==a||(a=9729),t.texParameteri(3553,10240,a),t.texParameteri(3553,10241,s),t.texParameteri(3553,10242,n),t.texParameteri(3553,10243,n),this.mipmap&&t.generateMipmap(3553)):(-1!==s||(s=9729),-1!==a||(a=9729),t.texParameteri(3553,10241,s),t.texParameteri(3553,10240,a),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),i&&r&&yt.bindTexture(t,i,r),this.canvas=null,h&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},e.disposeResource=function(){k.enabled&&this._allowMerageInAtlas||!this._source||(bt.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},e.clearAtlasSource=function(){},r(0,e,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),r(0,e,"atlasSource",function(){return this.canvas}),r(0,e,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(t){this._allowMerageInAtlas=t}),h}(),Qt=function(t){function o(t,e,i,r){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,o.__super.call(this),!t||!e)throw"Shader Error";this._id=++o._count,this._vs=t,this._ps=e,this._nameMap=r||{},null!=i&&(o.sharders[i]=this)}c(o,"laya.webgl.shader.Shader",Bt);var e=o.prototype;return e.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},e.disposeResource=function(){bt.mainContext.deleteShader(this._vshader),bt.mainContext.deleteShader(this._pshader),bt.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},e._compile=function(){if(this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var t=[this._vs,this._ps],e=bt.mainContext;if(this._program=e.createProgram(),this._vshader=o._createShader(e,t[0],35633),this._pshader=o._createShader(e,t[1],35632),e.attachShader(this._program,this._vshader),e.attachShader(this._program,this._pshader),e.linkProgram(this._program),!g.isConchApp&&!e.getProgramParameter(this._program,35714))throw e.getProgramInfoLog(this._program);var i,r,s=0,a=0;for(a=g.isConchApp?e.getProgramParameterEx(this._vs,this._ps,"",35721):e.getProgramParameter(this._program,35721),s=0;s<a;s++){var n=null;i={vartype:"attribute",glfun:null,ivartype:0,attrib:n=g.isConchApp?e.getActiveAttribEx(this._vs,this._ps,"",s):e.getActiveAttrib(this._program,s),location:e.getAttribLocation(this._program,n.name),name:n.name,type:n.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push(i)}var h=0;for(h=g.isConchApp?e.getProgramParameterEx(this._vs,this._ps,"",35718):e.getProgramParameter(this._program,35718),s=0;s<h;s++){var l=null;l=g.isConchApp?e.getActiveUniformEx(this._vs,this._ps,"",s):e.getActiveUniform(this._program,s),0<(i={vartype:"uniform",glfun:null,ivartype:1,attrib:n,location:e.getUniformLocation(this._program,l.name),name:l.name,type:l.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(i.name=i.name.substr(0,i.name.length-3),i.isArray=!0,i.location=e.getUniformLocation(this._program,i.name)),this._params.push(i)}for(s=0,r=this._params.length;s<r;s++)if((i=this._params[s]).indexOfParams=s,i.index=1,i.value=[i.location,null],i.codename=i.name,i.name=this._nameMap[i.codename]?this._nameMap[i.codename]:i.codename,(this._paramsMap[i.name]=i)._this=this,i.uploadedValue=[],"attribute"!==i.vartype)switch(i.type){case 5124:i.fun=i.isArray?this._uniform1iv:this._uniform1i;break;case 5126:i.fun=i.isArray?this._uniform1fv:this._uniform1f;break;case 35664:i.fun=i.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:i.fun=i.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:i.fun=i.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:i.fun=this._uniform_sampler2D;break;case 35680:i.fun=this._uniform_samplerCube;break;case 35676:i.glfun=e.uniformMatrix4fv,i.fun=this._uniformMatrix4fv;break;case 35670:i.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else i.fun=this._attribute}},e.getUniform=function(t){return this._paramsMap[t]},e._attribute=function(t,e){var i=bt.mainContext,r=Ot._enableAtributes,s=t.location;return r[s]||i.enableVertexAttribArray(s),i.vertexAttribPointer(s,e[0],e[1],e[2],e[3],e[4]+this._offset),r[s]=Ot._bindVertexBuffer,1},e._uniform1f=function(t,e){var i=t.uploadedValue;return i[0]!==e?(bt.mainContext.uniform1f(t.location,i[0]=e),1):0},e._uniform1fv=function(t,e){if(e.length<4){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(bt.mainContext.uniform1fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return bt.mainContext.uniform1fv(t.location,e),1},e._uniform_vec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(bt.mainContext.uniform2f(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_vec2v=function(t,e){if(e.length<2){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(bt.mainContext.uniform2fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return bt.mainContext.uniform2fv(t.location,e),1},e._uniform_vec3=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(bt.mainContext.uniform3f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3v=function(t,e){return bt.mainContext.uniform3fv(t.location,e),1},e._uniform_vec4=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(bt.mainContext.uniform4f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4v=function(t,e){return bt.mainContext.uniform4fv(t.location,e),1},e._uniformMatrix2fv=function(t,e){return bt.mainContext.uniformMatrix2fv(t.location,!1,e),1},e._uniformMatrix3fv=function(t,e){return bt.mainContext.uniformMatrix3fv(t.location,!1,e),1},e._uniformMatrix4fv=function(t,e){return bt.mainContext.uniformMatrix4fv(t.location,!1,e),1},e._uniform1i=function(t,e){var i=t.uploadedValue;return i[0]!==e?(bt.mainContext.uniform1i(t.location,i[0]=e),1):0},e._uniform1iv=function(t,e){return bt.mainContext.uniform1iv(t.location,e),1},e._uniform_ivec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(bt.mainContext.uniform2i(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_ivec2v=function(t,e){return bt.mainContext.uniform2iv(t.location,e),1},e._uniform_vec3i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(bt.mainContext.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3vi=function(t,e){return bt.mainContext.uniform3iv(t.location,e),1},e._uniform_vec4i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(bt.mainContext.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4vi=function(t,e){return bt.mainContext.uniform4iv(t.location,e),1},e._uniform_sampler2D=function(t,e){var i=bt.mainContext,r=t.uploadedValue;return null==r[0]?(r[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),i.activeTexture(o._TEXTURES[this._curActTexIndex]),yt.bindTexture(i,3553,e),this._curActTexIndex++,1):(i.activeTexture(o._TEXTURES[r[0]]),yt.bindTexture(i,3553,e),0)},e._uniform_samplerCube=function(t,e){var i=bt.mainContext,r=t.uploadedValue;return null==r[0]?(r[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),i.activeTexture(o._TEXTURES[this._curActTexIndex]),yt.bindTexture(i,34067,e),this._curActTexIndex++,1):(i.activeTexture(o._TEXTURES[r[0]]),yt.bindTexture(i,34067,e),0)},e._noSetValue=function(t){console.log("no....:"+t.name)},e.uploadOne=function(t,e){this.activeResource(),yt.UseProgram(this._program);var i=this._paramsMap[t];i.fun.call(this,i,e)},e.uploadTexture2D=function(t){C.shaderCall++;var e=bt.mainContext;e.activeTexture(33984),yt.bindTexture(e,3553,t)},e.upload=function(t,e){Bt.activeShader=Bt.bindShader=this,this._lastUseFrameCount===C.loopCount||this.activeResource(),yt.UseProgram(this._program),this._reCompile?(e=this._params,this._reCompile=!1):e=e||this._params;bt.mainContext;for(var i,r,s=e.length,a=0,n=0;n<s;n++)null!==(r=t[(i=e[n]).name])&&(a+=i.fun.call(this,i,r));C.shaderCall+=a},e.uploadArray=function(t,e,i){Bt.activeShader=this,(Bt.bindShader=this).activeResource(),yt.UseProgram(this._program);this._params;for(var r,s,a=0,n=e-2;0<=n;n-=2)(s=this._paramsMap[t[n]])&&null!=(r=t[n+1])&&(i&&i[s.name]&&i[s.name].bind(),a+=s.fun.call(this,s,r));C.shaderCall+=a},e.getParams=function(){return this._params},o.getShader=function(t){return o.sharders[t]},o.create=function(t,e,i,r){return new o(t,e,i,r)},o.withCompile=function(t,e,i,r){if(i&&o.sharders[i])return o.sharders[i];var s=o._preCompileShader[2e-4*t];if(!s)throw new Error("withCompile shader err!"+t);return s.createShader(e,i,r)},o.withCompile2D=function(t,e,i,r,s){if(r&&o.sharders[r])return o.sharders[r];var a=o._preCompileShader[2e-4*t+e];if(!a)throw new Error("withCompile shader err!"+t+" "+e);return a.createShader(i,r,s)},o.addInclude=function(t,e){xt.addInclude(t,e)},o.preCompile=function(t,e,i,r){var s=2e-4*t;o._preCompileShader[s]=new xt(s,e,i,r)},o.preCompile2D=function(t,e,i,r,s){var a=2e-4*t+e;o._preCompileShader[a]=new xt(a,i,r,s)},o._createShader=function(t,e,i){var r=t.createShader(i);return t.shaderSource(r,e),t.compileShader(r),r},o._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],o._count=0,o._preCompileShader={},o.SHADERNAME2ID=2e-4,o.sharders=((o.sharders=[]).length=32,o.sharders),n(o,["nameKey",function(){return this.nameKey=new L}]),o}(),Zt=function(t){function e(){this._maxsize=0,this._upload=!0,this._uploadSize=0,e.__super.call(this),this.lock=!0}c(e,"laya.webgl.utils.Buffer2D",t);var i=e.prototype;return i.needSize=function(t){var e=this._byteLength;if(t){var i=this._byteLength+t;i<=this._buffer.byteLength||this._resizeBuffer(i<<1,!0),this._byteLength=i}return e},i._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),C.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,Ot._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),Ot._gl.bufferSubData(this._bufferType,0,this._buffer)},i._bufferSubData=function(t,e,i){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._maxsize=Math.max(this._maxsize,this._byteLength),C.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,Ot._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),e||i){var r=this._buffer.slice(e,i);Ot._gl.bufferSubData(this._bufferType,t,r)}else Ot._gl.bufferSubData(this._bufferType,t,this._buffer)},i._checkArrayUse=function(){},i._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},i._bind_subUpload=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData(t,e,i),!0)},i._resizeBuffer=function(t,e){if(t<this._buffer.byteLength)return this;if(this.memorySize=t,e&&this._buffer&&0<this._buffer.byteLength){var i=new ArrayBuffer(t);new Uint8Array(i).set(new Uint8Array(this._buffer),0),this._buffer=i}else this._buffer=new ArrayBuffer(t);return this._checkArrayUse(),this._upload=!0,this},i.append=function(t){this._upload=!0;var e,i;e=t.byteLength,t instanceof Uint8Array?(this._resizeBuffer(this._byteLength+e,!0),i=new Uint8Array(this._buffer,this._byteLength)):t instanceof Uint16Array?(this._resizeBuffer(this._byteLength+e,!0),i=new Uint16Array(this._buffer,this._byteLength)):t instanceof Float32Array&&(this._resizeBuffer(this._byteLength+e,!0),i=new Float32Array(this._buffer,this._byteLength)),i.set(t,0),this._byteLength+=e,this._checkArrayUse()},i.appendU16Array=function(t,e){this._resizeBuffer(this._byteLength+2*e,!0);for(var i=new Uint16Array(this._buffer,this._byteLength,e),r=0;r<e;r++)i[r]=t[r];this._byteLength+=2*e,this._checkArrayUse()},i.appendEx=function(t,e){this._upload=!0;var i;i=t.byteLength,this._resizeBuffer(this._byteLength+i,!0),new e(this._buffer,this._byteLength).set(t,0),this._byteLength+=i,this._checkArrayUse()},i.appendEx2=function(t,e,i,r){void 0===r&&(r=1),this._upload=!0;var s,a;s=i*r,this._resizeBuffer(this._byteLength+s,!0),a=new e(this._buffer,this._byteLength);var n=0;for(n=0;n<i;n++)a[n]=t[n];this._byteLength+=s,this._checkArrayUse()},i.getBuffer=function(){return this._buffer},i.setNeedUpload=function(){this._upload=!0},i.getNeedUpload=function(){return this._upload},i.upload=function(){var t=this._bind_upload();return Ot._gl.bindBuffer(this._bufferType,null),Ot._bindActive[this._bufferType]=null,Bt.activeShader=null,t},i.subUpload=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var r=this._bind_subUpload();return Ot._gl.bindBuffer(this._bufferType,null),Ot._bindActive[this._bufferType]=null,Bt.activeShader=null,r},i.disposeResource=function(){t.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},i.clear=function(){this._byteLength=0,this._upload=!0},r(0,i,"bufferLength",function(){return this._buffer.byteLength}),r(0,i,"byteLength",null,function(t){this._byteLength!==t&&(t<=this._buffer.byteLength||this._resizeBuffer(2*t+256,!0),this._byteLength=t)}),e.__int__=function(t){$t.QuadrangleIB=$t.create(35044),pt.fillIBQuadrangle($t.QuadrangleIB,16)},e.FLOAT32=4,e.SHORT=2,e}(Ot),qt=(function(e){function i(t){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,i.__super.call(this,9)}c(i,"laya.webgl.shader.d2.value.GlowSV",e);var t=i.prototype;t.setValue=function(t){e.prototype.setValue.call(this,t)},t.clear=function(){e.prototype.clear.call(this)}}(Ht),function(t){function e(t){e.__super.call(this,64),this.defines.add(64)}c(e,"laya.webgl.shader.d2.value.TextSV",t);var i=e.prototype;return i.release=function(){(e.pool[e._length++]=this).clear()},i.clear=function(){t.prototype.clear.call(this)},e.create=function(){return e._length?e.pool[--e._length]:new e(null)},e.pool=[],e._length=0,e}(Ht)),jt=function(t){function s(t,e,i,r){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,s.__super.call(this,t,e,i,r)}c(s,"laya.webgl.shader.d2.Shader2X",t);var e=s.prototype;return e.upload2dQuick1=function(t){this.upload(t,this._params2dQuick1||this._make2dQuick1())},e._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var t,e=this._params,i=0,r=e.length;i<r;i++)t=e[i],(g.isFlash||"size"!==t.name&&"position"!==t.name&&"texcoord"!==t.name)&&this._params2dQuick1.push(t)}return this._params2dQuick1},e.disposeResource=function(){t.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},e.upload2dQuick2=function(t){this.upload(t,this._params2dQuick2||this._make2dQuick2())},e._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var t,e=this._params,i=0,r=e.length;i<r;i++)t=e[i],(g.isFlash||"size"!==t.name)&&this._params2dQuick2.push(t)}return this._params2dQuick2},s.create=function(t,e,i,r){return new s(t,e,i,r)},s}(Qt),$t=function(t){function e(t){this._uint8Array=null,this._uint16Array=null,void 0===t&&(t=35044),e.__super.call(this),this._bufferUsage=t,this._bufferType=34963,g.isFlash||(this._buffer=new ArrayBuffer(8))}c(e,"laya.webgl.utils.IndexBuffer2D",Zt);var i=e.prototype;return i._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},i.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},i.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},i.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},e.QuadrangleIB=null,e.create=function(t){return void 0===t&&(t=35044),new e(t)},e}(),Jt=function(t){function i(t,e){this._floatArray32=null,this._vertexStride=0,i.__super.call(this),this._vertexStride=t,this._bufferUsage=e,this._bufferType=34962,g.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}c(i,"laya.webgl.utils.VertexBuffer2D",t);var e=i.prototype;return e.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},e.bind=function(t){t&&t._bind(),this._bind()},e.insertData=function(t,e){this.getFloat32Array().set(t,e),this._upload=!0},e.bind_upload=function(t){t._bind_upload()||t._bind(),this._bind_upload()||this._bind()},e._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},e.disposeResource=function(){t.prototype.disposeResource.call(this)},e.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},r(0,e,"vertexStride",function(){return this._vertexStride}),i.create=function(t,e){return void 0===e&&(e=35048),new i(t,e)},i}(Zt),te=function(t){function a(t,e,i,r){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===i&&(i=6408),void 0===r&&(r=!0),a.__super.call(this,t,e),this._format=i,this._mipmap=r,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof t)this._url=t,this._src=t,this._image=new f.window.Image,e&&(e.onload&&(this.onload=e.onload),e.onerror&&(this.onerror=e.onerror),e.onCreate&&e.onCreate(this)),this._image.crossOrigin=t&&0==t.indexOf("data:")?null:"",t&&(this._image.src=t);else if(t instanceof ArrayBuffer){this._src=e,this._url=this._src;var s=new h(t);s.readUTFBytes(4),s.readUTFBytes(2),s.getInt16();s.endian="bigEndian",this._w=s.getInt16(),this._h=s.getInt16();s.getInt16(),s.getInt16();this._image=new Uint8Array(t,s.pos),this._format=bt.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,k.enabled&&this._w<k.atlasLimitWidth&&this._h<k.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else this._src=e,this._url=this._src,this._image=t.source||t,this.onresize();this._$5__enableMerageInAtlas=!0}c(a,"laya.webgl.resource.WebGLImage",m);var e=a.prototype;return T.imps(e,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),e._init_=function(t,e){},e._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var t=bt.mainContext,e=this._source=t.createTexture(),i=yt.curBindTexTarget,r=yt.curBindTexValue;if(yt.bindTexture(t,3553,e),g.isConchWebGL)switch(this._format){case 6408:t.texImage2DEx(!0,3553,0,this._format,6408,5121,this._image);break;case bt.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:t.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image)}else{switch(t.pixelStorei(37441,!0),this._format){case 6408:t.texImage2D(3553,0,this._format,6408,5121,this._image);break;case bt.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:t.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image)}t.pixelStorei(37441,!1)}var s=this.minFifter,a=this.magFifter,n=this.repeat?10497:33071,h=l.isPOT(this._w,this._h);h?(this.mipmap?-1!==s||(s=9987):-1!==s||(s=9729),-1!==a||(a=9729),t.texParameteri(3553,10241,s),t.texParameteri(3553,10240,a),t.texParameteri(3553,10242,n),t.texParameteri(3553,10243,n),this.mipmap&&t.generateMipmap(3553)):(-1!==s||(s=9729),-1!==a||(a=9729),t.texParameteri(3553,10241,s),t.texParameteri(3553,10240,a),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),i&&r&&yt.bindTexture(t,i,r),this._image.onload=null,this._image=null,h&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._recreateLock=!1},e.recreateResource=function(){var t=this;if(null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var e=this;this._image=new f.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if(e._needReleaseAgain)return e._needReleaseAgain=!1,e._image.onload=null,void(e._image=null);e._allowMerageInAtlas&&e._enableMerageInAtlas?(t.memorySize=0,t._recreateLock=!1):e._createWebGlTexture(),e.completeCreate()},this._image.src=this._src}},e.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(bt.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},e.onresize=function(){this._w=this._image.width,this._h=this._image.height,k.enabled&&this._w<k.atlasLimitWidth&&this._h<k.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},e.clearAtlasSource=function(){this._image=null},r(0,e,"format",function(){return this._format}),r(0,e,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function(t){this._$5__enableMerageInAtlas=t}),r(0,e,"mipmap",function(){return this._mipmap}),r(0,e,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),r(0,e,"atlasSource",function(){return this._image}),r(0,e,"onload",null,function(t){var e=this;this._onload=t,this._image&&(this._image.onload=null!=this._onload?function(){e.onresize(),e._onload()}:null)}),r(0,e,"onerror",null,function(t){var e=this;this._onerror=t,this._image&&(this._image.onerror=null!=this._onerror?function(){e._onerror()}:null)}),a}();T.__init([ft,U,At,xt])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var r=Laya[i];r&&r.__isclass&&(e[i]=r)}});